define(["lodash","angular","app/core/core"],function(t,e,n){return function(t){var e={};function n(a){if(e[a])return e[a].exports;var r=e[a]={i:a,l:!1,exports:{}};return t[a].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=t,n.c=e,n.d=function(t,e,a){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:a})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var a=Object.create(null);if(n.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)n.d(a,r,function(e){return t[e]}.bind(null,r));return a},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=8)}([function(e,n){e.exports=t},function(t,e,n){"use strict";function a(t){var e="default";for(var n in t)if("kentik-ds"===t[n].type)return"custom"===(e=t[n].jsonData.region)&&console.log("getRegion(): Custom Dynamic URL: "+t[n].jsonData.dynamicUrl),e;return e}n.d(e,"a",function(){return a})},function(t,e,n){"use strict";n.d(e,"a",function(){return i}),n.d(e,"b",function(){return o});var a=n(5),r=n(0);function i(t){var e="";e+=t.status?"("+t.status+") ":"",e+=t.statusText?t.statusText+": ":"",t.data&&t.data.error?e+=t.data.error:t.err?e+=t.err:r.isString(t)&&(e+=t),a.appEvents.emit("alert-error",["Can't connect to Kentik API",e])}function o(t,e,n){var i="";i+=e.status?"("+e.status+") ":"",i+=e.statusText?e.statusText+": ":"",e.data&&e.data.error?i+=e.data.error:e.err?i+=e.err:r.isString(e)&&(i+=e),a.appEvents.emit("alert-"+n,[t,i])}},function(t,n){t.exports=e},function(t,e,n){"use strict";n.d(e,"a",function(){return c});var a=n(3),r=n.n(a),i=n(1),o=function(t,e,n,a){return new(n||(n=Promise))(function(r,i){function o(t){try{c(a.next(t))}catch(t){i(t)}}function s(t){try{c(a.throw(t))}catch(t){i(t)}}function c(t){t.done?r(t.value):new n(function(e){e(t.value)}).then(o,s)}c((a=a.apply(t,e||[])).next())})},s=function(t,e){var n,a,r,i,o={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,a&&(r=2&i[0]?a.return:i[0]?a.throw||((r=a.return)&&r.call(a),0):a.next)&&!(r=r.call(a,i[1])).done)return r;switch(a=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,a=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!(r=(r=o.trys).length>0&&r[r.length-1])&&(6===i[0]||2===i[0])){o=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){o.label=i[1];break}if(6===i[0]&&o.label<r[1]){o.label=r[1],r=i;break}if(r&&o.label<r[2]){o.label=r[2],o.ops.push(i);break}r[2]&&o.ops.pop(),o.trys.pop();continue}i=e.call(t,o)}catch(t){i=[6,t],a=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}},c=function(){function t(t){var e=this;this.backendSrv=t,this.apiReady=!1,this.baseUrl="/api/plugin-proxy/kentik-app",t.get("/api/datasources").then(function(t){e.region=Object(i.a)(t),e.setRegion(e.region),e.apiReady=!0})}return t.$inject=["backendSrv"],t.prototype.setRegion=function(t){this.region=t},t.prototype.getDevices=function(){return o(this,void 0,void 0,function(){var t,e=this;return s(this,function(n){switch(n.label){case 0:return this.backendSrv.get("/api/datasources").then(function(t){e.region=Object(i.a)(t),e.setRegion(e.region),e.apiReady=!0}),[4,this._get("/api/v5/devices")];case 1:return(t=n.sent()).data&&t.data.devices?[2,t.data.devices]:[2,[]]}})})},t.prototype.getUsers=function(){return o(this,void 0,void 0,function(){return s(this,function(t){switch(t.label){case 0:return[4,this._get("/api/v5/users")];case 1:return[2,t.sent()]}})})},t.prototype.getFieldValues=function(t){var e="SELECT DISTINCT "+t+" FROM all_devices ORDER BY "+t+" ASC";return this.invokeSQLQuery(e)},t.prototype.getCustomDimensions=function(){return o(this,void 0,void 0,function(){return s(this,function(t){switch(t.label){case 0:return[4,this._get("/api/v5/customdimensions")];case 1:return[2,t.sent().data.customDimensions]}})})},t.prototype.getSavedFilters=function(){return o(this,void 0,void 0,function(){return s(this,function(t){switch(t.label){case 0:return[4,this._get("/api/v5/saved-filters")];case 1:return[2,t.sent().data]}})})},t.prototype.invokeTopXDataQuery=function(t){var e={queries:[{query:t,bucketIndex:0}]};return this._post("/api/v5/query/topXdata",e)},t.prototype.invokeSQLQuery=function(t){var e={query:t};return this._post("/api/v5/query/sql",e)},t.prototype._get=function(t){return o(this,void 0,void 0,function(){var e=this;return s(this,function(n){switch(n.label){case 0:return void 0!==this.region?[3,2]:[4,this.backendSrv.get("/api/datasources").then(function(t){e.setRegion(Object(i.a)(t))})];case 1:n.sent(),n.label=2;case 2:return[2,this.backendSrv.datasourceRequest({method:"GET",url:this.baseUrl+"/"+this.region+t}).catch(function(t){return console.error(t),t.err?Promise.reject(t.err):Promise.reject(t)})]}})})},t.prototype._post=function(t,e){return o(this,void 0,void 0,function(){var n=this;return s(this,function(a){switch(a.label){case 0:return void 0!==this.region?[3,2]:[4,this.backendSrv.get("/api/datasources").then(function(t){n.setRegion(Object(i.a)(t))})];case 1:a.sent(),a.label=2;case 2:return[2,this.backendSrv.datasourceRequest({method:"POST",url:this.baseUrl+"/"+this.region+t,data:e}).then(function(t){return t.data?t.data:[]}).catch(function(t){return console.error(t),t.err?Promise.reject(t.err):Promise.reject(t)})]}})})},t}();r.a.module("grafana.services").service("kentikAPISrv",c)},function(t,e){t.exports=n},,function(t,e){t.exports='<h3 class="page-heading">Enter your Kentik Credentials</h3>\n<div class="gf-form-group">\n  <div class="gf-form" ng-if="ctrl.apiError && ctrl.appModel.enabled">\n    <i class="fa fa-exclamation-circle" style="color: #ca4333;">\n      <span>Invalid API credentials. This app wont work until the credentials are updated.</span>\n    </i>\n  </div>\n  <div class="gf-form">\n    <label class="gf-form-label width-10">Email</label>\n    \x3c!-- Hidden input to stop chrome from autofilling --\x3e\n    <input style="display:none;" type="text" name="somefakename" />\n    <input type="text" class="gf-form-input width-30 max-width-30" ng-model=\'ctrl.appModel.jsonData.email\' placeholder="email" />\n  </div>\n\n  <div class="gf-form">\n    <label class="gf-form-label width-10">Region\n      <tip>US and EU regions are available. Default is US. A custom url can also be specified.</tip>\n    </label>\n    <div class="gf-form-select-wrapper">\n      <select class="gf-form-input" ng-model="ctrl.appModel.jsonData.region" ng-options="f.value as f.text for f in ctrl.regionTypes"></select>\n    </div>\n  </div>\n\n    \x3c!-- custom endpoint should display the url --\x3e\n  <div ng-if="ctrl.appModel.jsonData.region === \'custom\'" class="gf-form">\n    <label class="gf-form-label width-10">Custom URL\n      <tip>Specify custom url</tip>\n    </label>\n    <div ng-if="ctrl.appModel.jsonData.region === \'custom\'">\n      <input type="text" class="gf-form-input width-30 max-width-30" ng-model=\'ctrl.appModel.jsonData.dynamicUrl\' placeholder="https://grafana-api.kentik.com/api/v5" />\n    </div>\n  </div>\n\n  <div class="gf-form-inline">\n    <div class="gf-form kentik-inline-field-margin--right">\n      <label class="gf-form-label width-10">Api Token</label>\n      \x3c!-- Hidden input to stop chrome from autofilling --\x3e\n      <input style="display:none;" type="password" name="anotherfakename" />\n      <input type="password" class="gf-form-input width-30 max-width-30" ng-model="ctrl.appModel.secureJsonData.token" ng-if="!ctrl.appModel.jsonData.tokenSet"\n        placeholder="api token" />\n      <div ng-if="ctrl.appModel.jsonData.tokenSet" class="gf-form">\n        <input type="text" class="gf-form-input max-width-20" disabled="disabled" value="saved" />\n        <div ng-if="ctrl.appModel.enabled">\n          <i class="fa fa-exclamation-triangle" ng-if="!ctrl.apiValidated" alt="Could not validate api Token."></i>\n        </div>\n      </div>\n    </div>\n    <div class="gf-form">\n      <a class="btn btn-danger btn-small" href="#" ng-click="ctrl.reset()" ng-if="ctrl.appModel.jsonData.tokenSet">reset</a>\n    </div>\n  </div>\n</div>\n\n<div ng-if="ctrl.appModel.jsonData.tokenSet" class="kentik-enabled-box">\n  <i class="icon-gf icon-gf-check icon-gf-check kentik-icon-success"></i> Successfully enabled. <strong>Next up:\n  </strong><a href="dashboard/db/kentik-home" class="external-link">Go to Kentik Home Dashboard</a>\n</div>\n'},function(t,e,n){"use strict";n.r(e),n.d(e,"ConfigCtrl",function(){return u});var a=n(7),r=n.n(a),i=n(4),o=n(2),s=n(0),c=function(t,e,n,a){return new(n||(n=Promise))(function(r,i){function o(t){try{c(a.next(t))}catch(t){i(t)}}function s(t){try{c(a.throw(t))}catch(t){i(t)}}function c(t){t.done?r(t.value):new n(function(e){e(t.value)}).then(o,s)}c((a=a.apply(t,e||[])).next())})},l=function(t,e){var n,a,r,i,o={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,a&&(r=2&i[0]?a.return:i[0]?a.throw||((r=a.return)&&r.call(a),0):a.next)&&!(r=r.call(a,i[1])).done)return r;switch(a=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,a=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!(r=(r=o.trys).length>0&&r[r.length-1])&&(6===i[0]||2===i[0])){o=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){o.label=i[1];break}if(6===i[0]&&o.label<r[1]){o.label=r[1],r=i;break}if(r&&o.label<r[2]){o.label=r[2],o.ops.push(i);break}r[2]&&o.ops.pop(),o.trys.pop();continue}i=e.call(t,o)}catch(t){i=[6,t],a=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}},u=function(){function t(t,e,n){this.backendSrv=n,this.regionTypes=[{value:"default",text:"US (default)"},{value:"eu",text:"EU"},{value:"custom",text:"Custom"}],this.appEditCtrl.setPreUpdateHook(this.preUpdate.bind(this)),this.appEditCtrl.setPostUpdateHook(this.postUpdate.bind(this)),this.appModel.jsonData||(this.appModel.jsonData={}),this.appModel.secureJsonData||(this.appModel.secureJsonData={}),void 0===this.appModel.jsonData.region&&(this.appModel.jsonData.region="default"),this.apiValidated=!1,this.apiError=!1,this.kentik=new i.a(this.backendSrv),this.kentik.setRegion(this.appModel.jsonData.region),this.appModel.enabled&&this.appModel.jsonData.tokenSet&&this.validateApiConnection()}return t.$inject=["$scope","$injector","backendSrv"],t.prototype.preUpdate=function(){return this.appModel.secureJsonData.token&&(this.appModel.jsonData.tokenSet=!0),this.initDatasource()},t.prototype.postUpdate=function(){return c(this,void 0,void 0,function(){return l(this,function(t){switch(t.label){case 0:return this.appModel.enabled?[4,this.validateApiConnection()]:[2,Promise.resolve()];case 1:return t.sent(),[4,this.appEditCtrl.importDashboards()];case 2:return t.sent(),[2,{url:"dashboard/db/kentik-home",message:"Kentik Connect Pro app installed!"}]}})})},t.prototype.validateApiConnection=function(){return c(this,void 0,void 0,function(){var t,e;return l(this,function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,this.kentik.getUsers()];case 1:t=n.sent();try{t.hasOwnProperty("data")&&(this.apiValidated=!0,Object(o.b)("API working!","","success"))}catch(t){Object(o.a)("Unexpected result from API: "+t),this.apiValidated=!1,this.apiError=!0}return[3,3];case 2:return e=n.sent(),Object(o.a)(e),this.apiValidated=!1,this.apiError=!0,[3,3];case 3:return[2]}})})},t.prototype.reset=function(){this.appModel.jsonData.email="",this.appModel.jsonData.tokenSet=!1,this.appModel.jsonData.region="default",this.appModel.jsonData.dynamicUrl="",this.appModel.secureJsonData={},this.apiValidated=!1},t.prototype.initDatasource=function(){var t=this,e=this;return e.backendSrv.get("/api/datasources").then(function(n){var a=!1,r=!1,i=NaN;s.forEach(n,function(e){if("kentik-ds"===e.type)return a=!0,i=e.id,r=!0,e.jsonData.region!==t.appModel.jsonData.region&&(r=!0),void(e.jsonData!==t.appModel.jsonData&&(r=!0))});var o=[];if(!a||r){var c={name:"kentik",type:"kentik-ds",access:"proxy",jsonData:e.appModel.jsonData};r?o.push(e.backendSrv.put("/api/datasources/"+i,c)):o.push(e.backendSrv.post("/api/datasources",c))}return Promise.all(o)})},t}();u.template=r.a}])});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vd2VicGFjay9ib290c3RyYXAiLCJ3ZWJwYWNrOi8vL2V4dGVybmFsIFwibG9kYXNoXCIiLCJ3ZWJwYWNrOi8vLy4vZGF0YXNvdXJjZS9yZWdpb25IZWxwZXIudHMiLCJ3ZWJwYWNrOi8vLy4vZGF0YXNvdXJjZS9hbGVydEhlbHBlci50cyIsIndlYnBhY2s6Ly8vZXh0ZXJuYWwgXCJhbmd1bGFyXCIiLCJ3ZWJwYWNrOi8vLy4vZGF0YXNvdXJjZS9rZW50aWtBUEkudHMiLCJ3ZWJwYWNrOi8vLy4vY29uZmlnL2NvbmZpZy50cyJdLCJuYW1lcyI6WyJpbnN0YWxsZWRNb2R1bGVzIiwiX193ZWJwYWNrX3JlcXVpcmVfXyIsIm1vZHVsZUlkIiwiZXhwb3J0cyIsIm1vZHVsZSIsImkiLCJsIiwibW9kdWxlcyIsImNhbGwiLCJtIiwiYyIsImQiLCJuYW1lIiwiZ2V0dGVyIiwibyIsIk9iamVjdCIsImRlZmluZVByb3BlcnR5IiwiZW51bWVyYWJsZSIsImdldCIsInIiLCJTeW1ib2wiLCJ0b1N0cmluZ1RhZyIsInZhbHVlIiwidCIsIm1vZGUiLCJfX2VzTW9kdWxlIiwibnMiLCJjcmVhdGUiLCJrZXkiLCJiaW5kIiwibiIsIm9iamVjdCIsInByb3BlcnR5IiwicHJvdG90eXBlIiwiaGFzT3duUHJvcGVydHkiLCJwIiwicyIsIl9fV0VCUEFDS19FWFRFUk5BTF9NT0RVTEVfXzBfXyIsImdldFJlZ2lvbiIsImRhdGFzb3VyY2VzIiwiYVJlZ2lvbiIsImluZGV4IiwidHlwZSIsImpzb25EYXRhIiwicmVnaW9uIiwiY29uc29sZSIsImxvZyIsImR5bmFtaWNVcmwiLCJfX3dlYnBhY2tfZXhwb3J0c19fIiwic2hvd0FsZXJ0Iiwic2hvd0N1c3RvbUFsZXJ0IiwiZ3JhZmFuYV9hcHBfY29yZV9jb3JlX19XRUJQQUNLX0lNUE9SVEVEX01PRFVMRV8wX18iLCJsb2Rhc2hfX1dFQlBBQ0tfSU1QT1JURURfTU9EVUxFXzFfXyIsImVycm9yIiwibWVzc2FnZSIsInN0YXR1cyIsInN0YXR1c1RleHQiLCJkYXRhIiwiZXJyIiwiZW1pdCIsImV4Y2VwdGlvbkRhdGEiLCJleGNlcHRpb25UeXBlIiwiZXJyTWVzc2FnZSIsIl9fV0VCUEFDS19FWFRFUk5BTF9NT0RVTEVfXzNfXyIsIktlbnRpa0FQSSIsImJhY2tlbmRTcnYiLCJfdGhpcyIsInRoaXMiLCJhcGlSZWFkeSIsImJhc2VVcmwiLCJ0aGVuIiwiYWxsRFMiLCJfcmVnaW9uSGVscGVyX19XRUJQQUNLX0lNUE9SVEVEX01PRFVMRV8xX18iLCJzZXRSZWdpb24iLCIkaW5qZWN0IiwicmVzcCIsIl9hIiwic2VudCIsImRldmljZXMiLCJnZXRGaWVsZFZhbHVlcyIsImZpZWxkIiwicXVlcnkiLCJpbnZva2VTUUxRdWVyeSIsImludm9rZVRvcFhEYXRhUXVlcnkiLCJrZW50aWtWNVF1ZXJ5IiwicXVlcmllcyIsImJ1Y2tldEluZGV4IiwiX3Bvc3QiLCJkYXRhc291cmNlUmVxdWVzdCIsIm1ldGhvZCIsInVybCIsImNhdGNoIiwiUHJvbWlzZSIsInJlamVjdCIsInJlc3BvbnNlIiwiS2VudGlrQ29uZmlnQ3RybCIsIiRzY29wZSIsIiRpbmplY3RvciIsInJlZ2lvblR5cGVzIiwidGV4dCIsImFwcEVkaXRDdHJsIiwic2V0UHJlVXBkYXRlSG9vayIsInByZVVwZGF0ZSIsInNldFBvc3RVcGRhdGVIb29rIiwicG9zdFVwZGF0ZSIsImFwcE1vZGVsIiwic2VjdXJlSnNvbkRhdGEiLCJhcGlWYWxpZGF0ZWQiLCJhcGlFcnJvciIsImtlbnRpayIsIl9kYXRhc291cmNlX2tlbnRpa0FQSV9fV0VCUEFDS19JTVBPUlRFRF9NT0RVTEVfMV9fIiwiZW5hYmxlZCIsInRva2VuU2V0IiwidmFsaWRhdGVBcGlDb25uZWN0aW9uIiwidG9rZW4iLCJpbml0RGF0YXNvdXJjZSIsImxhYmVsIiwicmVzb2x2ZSIsImltcG9ydERhc2hib2FyZHMiLCJnZXRVc2VycyIsInJlc3VsdCIsIl9kYXRhc291cmNlX2FsZXJ0SGVscGVyX19XRUJQQUNLX0lNUE9SVEVEX01PRFVMRV8yX18iLCJlIiwiZV8xIiwicmVzZXQiLCJlbWFpbCIsInNlbGYiLCJyZXN1bHRzIiwiZm91bmRLZW50aWtEUyIsInVwZGF0ZUtlbnRpa0RTIiwiZHNJRCIsIk5hTiIsImRzIiwiaWQiLCJwcm9taXNlcyIsImFjY2VzcyIsInB1c2giLCJwdXQiLCJwb3N0IiwiYWxsIl0sIm1hcHBpbmdzIjoiK0VBQ0EsSUFBQUEsRUFBQSxHQUdBLFNBQUFDLEVBQUFDLEdBR0EsR0FBQUYsRUFBQUUsR0FDQSxPQUFBRixFQUFBRSxHQUFBQyxRQUdBLElBQUFDLEVBQUFKLEVBQUFFLEdBQUEsQ0FDQUcsRUFBQUgsRUFDQUksR0FBQSxFQUNBSCxRQUFBLElBVUEsT0FOQUksRUFBQUwsR0FBQU0sS0FBQUosRUFBQUQsUUFBQUMsSUFBQUQsUUFBQUYsR0FHQUcsRUFBQUUsR0FBQSxFQUdBRixFQUFBRCxRQTBEQSxPQXJEQUYsRUFBQVEsRUFBQUYsRUFHQU4sRUFBQVMsRUFBQVYsRUFHQUMsRUFBQVUsRUFBQSxTQUFBUixFQUFBUyxFQUFBQyxHQUNBWixFQUFBYSxFQUFBWCxFQUFBUyxJQUNBRyxPQUFBQyxlQUFBYixFQUFBUyxFQUFBLENBQTBDSyxZQUFBLEVBQUFDLElBQUFMLEtBSzFDWixFQUFBa0IsRUFBQSxTQUFBaEIsR0FDQSxvQkFBQWlCLGVBQUFDLGFBQ0FOLE9BQUFDLGVBQUFiLEVBQUFpQixPQUFBQyxZQUFBLENBQXdEQyxNQUFBLFdBRXhEUCxPQUFBQyxlQUFBYixFQUFBLGNBQWlEbUIsT0FBQSxLQVFqRHJCLEVBQUFzQixFQUFBLFNBQUFELEVBQUFFLEdBRUEsR0FEQSxFQUFBQSxJQUFBRixFQUFBckIsRUFBQXFCLElBQ0EsRUFBQUUsRUFBQSxPQUFBRixFQUNBLEtBQUFFLEdBQUEsaUJBQUFGLFFBQUFHLFdBQUEsT0FBQUgsRUFDQSxJQUFBSSxFQUFBWCxPQUFBWSxPQUFBLE1BR0EsR0FGQTFCLEVBQUFrQixFQUFBTyxHQUNBWCxPQUFBQyxlQUFBVSxFQUFBLFdBQXlDVCxZQUFB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OUQsV0FDRHNGLEdBQU8sVUFLVEssRUFBQSxPQUNBTixHQUFlQyxFQUFBLEtBRWJwQixFQUFNLENBQ05qRyxLQUFNLFNBQ044QixLQUFBLFlBQ0E2RixPQUFBLFFBQ0U1RixTQUFBbUYsRUFBY3JCLFNBQUU5RCxVQUVuQnNGLElBQU1PLEtBQUFWLEVBQUE3RCxXQUFBd0UsSUFBQSxvQkFBQVAsRUFBQXJCLElBR1J5QixFQUFBRSxLQUFBVixFQUFBN0QsV0FBQXlFLEtBQUEsbUJBQUE3QixJQUlKLE9BQUFqQixRQUFBK0MsSUFBQUwsTUFHSHZDLEVBekhrQiIsImZpbGUiOiJjb25maWcvbW9kdWxlLmpzIiwic291cmNlc0NvbnRlbnQiOlsiIFx0Ly8gVGhlIG1vZHVsZSBjYWNoZVxuIFx0dmFyIGluc3RhbGxlZE1vZHVsZXMgPSB7fTtcblxuIFx0Ly8gVGhlIHJlcXVpcmUgZnVuY3Rpb25cbiBcdGZ1bmN0aW9uIF9fd2VicGFja19yZXF1aXJlX18obW9kdWxlSWQpIHtcblxuIFx0XHQvLyBDaGVjayBpZiBtb2R1bGUgaXMgaW4gY2FjaGVcbiBcdFx0aWYoaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0pIHtcbiBcdFx0XHRyZXR1cm4gaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0uZXhwb3J0cztcbiBcdFx0fVxuIFx0XHQvLyBDcmVhdGUgYSBuZXcgbW9kdWxlIChhbmQgcHV0IGl0IGludG8gdGhlIGNhY2hlKVxuIFx0XHR2YXIgbW9kdWxlID0gaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0gPSB7XG4gXHRcdFx0aTogbW9kdWxlSWQsXG4gXHRcdFx0bDogZmFsc2UsXG4gXHRcdFx0ZXhwb3J0czoge31cbiBcdFx0fTtcblxuIFx0XHQvLyBFeGVjdXRlIHRoZSBtb2R1bGUgZnVuY3Rpb25cbiBcdFx0bW9kdWxlc1ttb2R1bGVJZF0uY2FsbChtb2R1bGUuZXhwb3J0cywgbW9kdWxlLCBtb2R1bGUuZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXyk7XG5cbiBcdFx0Ly8gRmxhZyB0aGUgbW9kdWxlIGFzIGxvYWRlZFxuIFx0XHRtb2R1bGUubCA9IHRydWU7XG5cbiBcdFx0Ly8gUmV0dXJuIHRoZSBleHBvcnRzIG9mIHRoZSBtb2R1bGVcbiBcdFx0cmV0dXJuIG1vZHVsZS5leHBvcnRzO1xuIFx0fVxuXG5cbiBcdC8vIGV4cG9zZSB0aGUgbW9kdWxlcyBvYmplY3QgKF9fd2VicGFja19tb2R1bGVzX18pXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLm0gPSBtb2R1bGVzO1xuXG4gXHQvLyBleHBvc2UgdGhlIG1vZHVsZSBjYWNoZVxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5jID0gaW5zdGFsbGVkTW9kdWxlcztcblxuIFx0Ly8gZGVmaW5lIGdldHRlciBmdW5jdGlvbiBmb3IgaGFybW9ueSBleHBvcnRzXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLmQgPSBmdW5jdGlvbihleHBvcnRzLCBuYW1lLCBnZXR0ZXIpIHtcbiBcdFx0aWYoIV9fd2VicGFja19yZXF1aXJlX18ubyhleHBvcnRzLCBuYW1lKSkge1xuIFx0XHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBuYW1lLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZ2V0dGVyIH0pO1xuIFx0XHR9XG4gXHR9O1xuXG4gXHQvLyBkZWZpbmUgX19lc01vZHVsZSBvbiBleHBvcnRzXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLnIgPSBmdW5jdGlvbihleHBvcnRzKSB7XG4gXHRcdGlmKHR5cGVvZiBTeW1ib2wgIT09ICd1bmRlZmluZWQnICYmIFN5bWJvbC50b1N0cmluZ1RhZykge1xuIFx0XHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBTeW1ib2wudG9TdHJpbmdUYWcsIHsgdmFsdWU6ICdNb2R1bGUnIH0pO1xuIFx0XHR9XG4gXHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAnX19lc01vZHVsZScsIHsgdmFsdWU6IHRydWUgfSk7XG4gXHR9O1xuXG4gXHQvLyBjcmVhdGUgYSBmYWtlIG5hbWVzcGFjZSBvYmplY3RcbiBcdC8vIG1vZGUgJiAxOiB2YWx1ZSBpcyBhIG1vZHVsZSBpZCwgcmVxdWlyZSBpdFxuIFx0Ly8gbW9kZSAmIDI6IG1lcmdlIGFsbCBwcm9wZXJ0aWVzIG9mIHZhbHVlIGludG8gdGhlIG5zXG4gXHQvLyBtb2RlICYgNDogcmV0dXJuIHZhbHVlIHdoZW4gYWxyZWFkeSBucyBvYmplY3RcbiBcdC8vIG1vZGUgJiA4fDE6IGJlaGF2ZSBsaWtlIHJlcXVpcmVcbiBcdF9fd2VicGFja19yZXF1aXJlX18udCA9IGZ1bmN0aW9uKHZhbHVlLCBtb2RlKSB7XG4gXHRcdGlmKG1vZGUgJiAxKSB2YWx1ZSA9IF9fd2VicGFja19yZXF1aXJlX18odmFsdWUpO1xuIFx0XHRpZihtb2RlICYgOCkgcmV0dXJuIHZhbHVlO1xuIFx0XHRpZigobW9kZSAmIDQpICYmIHR5cGVvZiB2YWx1ZSA9PT0gJ29iamVjdCcgJiYgdmFsdWUgJiYgdmFsdWUuX19lc01vZHVsZSkgcmV0dXJuIHZhbHVlO1xuIFx0XHR2YXIgbnMgPSBPYmplY3QuY3JlYXRlKG51bGwpO1xuIFx0XHRfX3dlYnBhY2tfcmVxdWlyZV9fLnIobnMpO1xuIFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkobnMsICdkZWZhdWx0JywgeyBlbnVtZXJhYmxlOiB0cnVlLCB2YWx1ZTogdmFsdWUgfSk7XG4gXHRcdGlmKG1vZGUgJiAyICYmIHR5cGVvZiB2YWx1ZSAhPSAnc3RyaW5nJykgZm9yKHZhciBrZXkgaW4gdmFsdWUpIF9fd2VicGFja19yZXF1aXJlX18uZChucywga2V5LCBmdW5jdGlvbihrZXkpIHsgcmV0dXJuIHZhbHVlW2tleV07IH0uYmluZChudWxsLCBrZXkpKTtcbiBcdFx0cmV0dXJuIG5zO1xuIFx0fTtcblxuIFx0Ly8gZ2V0RGVmYXVsdEV4cG9ydCBmdW5jdGlvbiBmb3IgY29tcGF0aWJpbGl0eSB3aXRoIG5vbi1oYXJtb255IG1vZHVsZXNcbiBcdF9fd2VicGFja19yZXF1aXJlX18ubiA9IGZ1bmN0aW9uKG1vZHVsZSkge1xuIFx0XHR2YXIgZ2V0dGVyID0gbW9kdWxlICYmIG1vZHVsZS5fX2VzTW9kdWxlID9cbiBcdFx0XHRmdW5jdGlvbiBnZXREZWZhdWx0KCkgeyByZXR1cm4gbW9kdWxlWydkZWZhdWx0J107IH0gOlxuIFx0XHRcdGZ1bmN0aW9uIGdldE1vZHVsZUV4cG9ydHMoKSB7IHJldHVybiBtb2R1bGU7IH07XG4gXHRcdF9fd2VicGFja19yZXF1aXJlX18uZChnZXR0ZXIsICdhJywgZ2V0dGVyKTtcbiBcdFx0cmV0dXJuIGdldHRlcjtcbiBcdH07XG5cbiBcdC8vIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbFxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5vID0gZnVuY3Rpb24ob2JqZWN0LCBwcm9wZXJ0eSkgeyByZXR1cm4gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG9iamVjdCwgcHJvcGVydHkpOyB9O1xuXG4gXHQvLyBfX3dlYnBhY2tfcHVibGljX3BhdGhfX1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5wID0gXCJcIjtcblxuXG4gXHQvLyBMb2FkIGVudHJ5IG1vZHVsZSBhbmQgcmV0dXJuIGV4cG9ydHNcbiBcdHJldHVybiBfX3dlYnBhY2tfcmVxdWlyZV9fKF9fd2VicGFja19yZXF1aXJlX18ucyA9IDgpO1xuIiwibW9kdWxlLmV4cG9ydHMgPSBfX1dFQlBBQ0tfRVhURVJOQUxfTU9EVUxFX18wX187IiwiIC8qKlxuICAqIFJldHVybnMgdGhlIHJlZ2lvbiBhc3NvY2lhdGVkIHdpdGggdGhlIGtlbnRpay1rc1xuXG4gICogQHBhcmFtIGRhdGFzb3VyY2VzIFxuICAqL1xuZnVuY3Rpb24gZ2V0UmVnaW9uKGRhdGFzb3VyY2VzOiBhbnkpOiBzdHJpbmcge1xuICBsZXQgYVJlZ2lvbiA9IFwiZGVmYXVsdFwiO1xuICBmb3IgKHZhciBpbmRleCBpbiBkYXRhc291cmNlcykge1xuICAgIGlmIChkYXRhc291cmNlc1tpbmRleF0udHlwZSA9PT0gXCJrZW50aWstZHNcIikge1xuICAgICAgYVJlZ2lvbiA9IGRhdGFzb3VyY2VzW2luZGV4XS5qc29uRGF0YS5yZWdpb247XG4gICAgICBpZiAoYVJlZ2lvbiA9PT0gJ2N1c3RvbScpIHtcbiAgICAgICAgY29uc29sZS5sb2coXCJnZXRSZWdpb24oKTogQ3VzdG9tIER5bmFtaWMgVVJMOiBcIiArIGRhdGFzb3VyY2VzW2luZGV4XS5qc29uRGF0YS5keW5hbWljVXJsKTtcbiAgICAgICAgLy9jb25zb2xlLmxvZyhcImdldFJlZ2lvbigpOiBDdXN0b20gRFMgSW5mbzogXCIgKyBKU09OLnN0cmluZ2lmeShkYXRhc291cmNlc1tpbmRleF0pKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBhUmVnaW9uO1xuICAgIH1cbiAgfVxuICByZXR1cm4gYVJlZ2lvbjtcbn1cblxuZXhwb3J0IHsgZ2V0UmVnaW9uIH1cbiIsImltcG9ydCB7IGFwcEV2ZW50cyB9IGZyb20gJ2dyYWZhbmEvYXBwL2NvcmUvY29yZSc7XG5pbXBvcnQgKiBhcyBfIGZyb20gJ2xvZGFzaCc7XG5cbmZ1bmN0aW9uIHNob3dBbGVydChlcnJvcikge1xuICBsZXQgbWVzc2FnZSA9ICcnO1xuICBtZXNzYWdlICs9IGVycm9yLnN0YXR1cyA/IGAoJHtlcnJvci5zdGF0dXN9KSBgIDogJyc7XG4gIG1lc3NhZ2UgKz0gZXJyb3Iuc3RhdHVzVGV4dCA/IGVycm9yLnN0YXR1c1RleHQgKyAnOiAnIDogJyc7XG4gIGlmIChlcnJvci5kYXRhICYmIGVycm9yLmRhdGEuZXJyb3IpIHtcbiAgICBtZXNzYWdlICs9IGVycm9yLmRhdGEuZXJyb3I7XG4gIH0gZWxzZSBpZiAoZXJyb3IuZXJyKSB7XG4gICAgbWVzc2FnZSArPSBlcnJvci5lcnI7XG4gIH0gZWxzZSBpZiAoXy5pc1N0cmluZyhlcnJvcikpIHtcbiAgICBtZXNzYWdlICs9IGVycm9yO1xuICB9XG5cbiAgYXBwRXZlbnRzLmVtaXQoJ2FsZXJ0LWVycm9yJywgW1wiQ2FuJ3QgY29ubmVjdCB0byBLZW50aWsgQVBJXCIsIG1lc3NhZ2VdKTtcbn1cblxuZnVuY3Rpb24gc2hvd0N1c3RvbUFsZXJ0KG1lc3NhZ2UsIGV4Y2VwdGlvbkRhdGEsIGV4Y2VwdGlvblR5cGUpIHtcbiAgbGV0IGVyck1lc3NhZ2UgPSAnJztcbiAgZXJyTWVzc2FnZSArPSBleGNlcHRpb25EYXRhLnN0YXR1cyA/IGAoJHtleGNlcHRpb25EYXRhLnN0YXR1c30pIGAgOiAnJztcbiAgZXJyTWVzc2FnZSArPSBleGNlcHRpb25EYXRhLnN0YXR1c1RleHQgPyBleGNlcHRpb25EYXRhLnN0YXR1c1RleHQgKyAnOiAnIDogJyc7XG4gIGlmIChleGNlcHRpb25EYXRhLmRhdGEgJiYgZXhjZXB0aW9uRGF0YS5kYXRhLmVycm9yKSB7XG4gICAgZXJyTWVzc2FnZSArPSBleGNlcHRpb25EYXRhLmRhdGEuZXJyb3I7XG4gIH0gZWxzZSBpZiAoZXhjZXB0aW9uRGF0YS5lcnIpIHtcbiAgICBlcnJNZXNzYWdlICs9IGV4Y2VwdGlvbkRhdGEuZXJyO1xuICB9IGVsc2UgaWYgKF8uaXNTdHJpbmcoZXhjZXB0aW9uRGF0YSkpIHtcbiAgICBlcnJNZXNzYWdlICs9IGV4Y2VwdGlvbkRhdGE7XG4gIH1cbiAgYXBwRXZlbnRzLmVtaXQoYGFsZXJ0LSR7ZXhjZXB0aW9uVHlwZX1gLCBbbWVzc2FnZSwgZXJyTWVzc2FnZV0pO1xufVxuXG5leHBvcnQgeyBzaG93QWxlcnQsIHNob3dDdXN0b21BbGVydCB9O1xuIiwibW9kdWxlLmV4cG9ydHMgPSBfX1dFQlBBQ0tfRVhURVJOQUxfTU9EVUxFX18zX187IiwiaW1wb3J0ICogYXMgXyBmcm9tICdsb2Rhc2gnO1xuaW1wb3J0IGFuZ3VsYXIgZnJvbSAnYW5ndWxhcic7XG5pbXBvcnQgeyBnZXRSZWdpb24gfSBmcm9tIFwiLi9yZWdpb25IZWxwZXJcIjtcblxuZXhwb3J0IGNsYXNzIEtlbnRpa0FQSSB7XG4gIGJhc2VVcmw6IHN0cmluZztcbiAgcmVnaW9uOiBzdHJpbmc7XG4gIGFwaVJlYWR5OiBib29sZWFuO1xuICAvKiogQG5nSW5qZWN0ICovXG4gIGNvbnN0cnVjdG9yKHB1YmxpYyBiYWNrZW5kU3J2OiBhbnkpIHtcbiAgICB0aGlzLmFwaVJlYWR5ID0gZmFsc2U7XG4gICAgdGhpcy5iYXNlVXJsID0gXCIvYXBpL3BsdWdpbi1wcm94eS9rZW50aWstYXBwXCI7XG4gICAgLy8gZ2V0IHJlZ2lvbiBmcm9tIGRhdGFzb3VyY2VcbiAgICBiYWNrZW5kU3J2LmdldCgnL2FwaS9kYXRhc291cmNlcycpLnRoZW4oIChhbGxEUzogYW55KSA9PiB7XG4gICAgICB0aGlzLnJlZ2lvbiA9IGdldFJlZ2lvbihhbGxEUyk7XG4gICAgICB0aGlzLnNldFJlZ2lvbih0aGlzLnJlZ2lvbik7XG4gICAgICB0aGlzLmFwaVJlYWR5ID0gdHJ1ZTtcbiAgICB9KTtcbiAgfVxuXG4gIHNldFJlZ2lvbihyZWdpb246IHN0cmluZykge1xuICAgIHRoaXMucmVnaW9uID0gcmVnaW9uO1xuICB9XG5cbiAgYXN5bmMgZ2V0RGV2aWNlcygpIHtcbiAgICB0aGlzLmJhY2tlbmRTcnYuZ2V0KCcvYXBpL2RhdGFzb3VyY2VzJykudGhlbiggKGFsbERTOiBhbnkpID0+IHtcbiAgICAgIHRoaXMucmVnaW9uID0gZ2V0UmVnaW9uKGFsbERTKTtcbiAgICAgIHRoaXMuc2V0UmVnaW9uKHRoaXMucmVnaW9uKTtcbiAgICAgIHRoaXMuYXBpUmVhZHkgPSB0cnVlO1xuICAgIH0pO1xuXG4gICAgY29uc3QgcmVzcCA9IGF3YWl0IHRoaXMuX2dldCgnL2FwaS92NS9kZXZpY2VzJyk7XG5cbiAgICBpZiAocmVzcC5kYXRhICYmIHJlc3AuZGF0YS5kZXZpY2VzKSB7XG4gICAgICByZXR1cm4gcmVzcC5kYXRhLmRldmljZXM7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiBbXTtcbiAgICB9XG4gIH1cblxuICBhc3luYyBnZXRVc2VycygpIHtcbiAgICBjb25zdCBkYXRhID0gYXdhaXQgdGhpcy5fZ2V0KCcvYXBpL3Y1L3VzZXJzJylcbiAgICByZXR1cm4gZGF0YTtcbiAgfVxuXG4gIGdldEZpZWxkVmFsdWVzKGZpZWxkOiBzdHJpbmcpIHtcbiAgICBjb25zdCBxdWVyeSA9IGBTRUxFQ1QgRElTVElOQ1QgJHtmaWVsZH0gRlJPTSBhbGxfZGV2aWNlcyBPUkRFUiBCWSAke2ZpZWxkfSBBU0NgO1xuICAgIHJldHVybiB0aGlzLmludm9rZVNRTFF1ZXJ5KHF1ZXJ5KTtcbiAgfVxuXG4gIGFzeW5jIGdldEN1c3RvbURpbWVuc2lvbnMoKSB7XG4gICAgY29uc3QgZGF0YSA9IGF3YWl0IHRoaXMuX2dldCgnL2FwaS92NS9jdXN0b21kaW1lbnNpb25zJyk7XG4gICAgcmV0dXJuIGRhdGEuZGF0YS5jdXN0b21EaW1lbnNpb25zO1xuICB9XG5cbiAgYXN5bmMgZ2V0U2F2ZWRGaWx0ZXJzKCkge1xuICAgIGNvbnN0IGRhdGEgPSBhd2FpdCB0aGlzLl9nZXQoJy9hcGkvdjUvc2F2ZWQtZmlsdGVycycpO1xuICAgIHJldHVybiBkYXRhLmRhdGE7XG4gIH1cblxuICBpbnZva2VUb3BYRGF0YVF1ZXJ5KHF1ZXJ5OiBhbnkpIHtcbiAgICBjb25zdCBrZW50aWtWNVF1ZXJ5ID0ge1xuICAgICAgcXVlcmllczogW3sgcXVlcnk6IHF1ZXJ5LCBidWNrZXRJbmRleDogMCB9XSxcbiAgICB9O1xuXG4gICAgcmV0dXJuIHRoaXMuX3Bvc3QoJy9hcGkvdjUvcXVlcnkvdG9wWGRhdGEnLCBrZW50aWtWNVF1ZXJ5KTtcbiAgfVxuXG4gIGludm9rZVNRTFF1ZXJ5KHF1ZXJ5OiBhbnkpIHtcbiAgICBjb25zdCBkYXRhID0ge1xuICAgICAgcXVlcnk6IHF1ZXJ5LFxuICAgIH07XG5cbiAgICByZXR1cm4gdGhpcy5fcG9zdCgnL2FwaS92NS9xdWVyeS9zcWwnLCBkYXRhKTtcbiAgfVxuXG4gIGFzeW5jIF9nZXQodXJsOiBzdHJpbmcpIHtcbiAgICAvLyBpZiB0aGUgcmVnaW9uIGlzIG5vdCBzZXQsIGdldCBpdCBmcm9tIHRoZSBkYXRhc291cmNlXG4gICAgaWYgKHR5cGVvZiB0aGlzLnJlZ2lvbiA9PT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgIC8vY29uc29sZS5sb2coXCJfZ2V0OiB0aGlzLnJlZ2lvbiBVTkRFRklORUQsIGZldGNoaW5nXCIpO1xuICAgICAgYXdhaXQgdGhpcy5iYWNrZW5kU3J2LmdldCgnL2FwaS9kYXRhc291cmNlcycpLnRoZW4oIChhbGxEUzogYW55KSA9PiB7XG4gICAgICAgIHRoaXMuc2V0UmVnaW9uKGdldFJlZ2lvbihhbGxEUykpO1xuICAgICAgICAvL2NvbnNvbGUubG9nKFwia2VudGlrQVBJOiBfZ2V0OiBGRVRDSEVEIHJlZ2lvbiBcIiArIHRoaXMucmVnaW9uKTtcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIHJldHVybiB0aGlzLmJhY2tlbmRTcnZcbiAgICAgIC5kYXRhc291cmNlUmVxdWVzdCh7XG4gICAgICAgIG1ldGhvZDogJ0dFVCcsXG4gICAgICAgIHVybDogdGhpcy5iYXNlVXJsICsgXCIvXCIgKyB0aGlzLnJlZ2lvbiArIHVybCxcbiAgICAgIH0pXG4gICAgICAuY2F0Y2goZXJyb3IgPT4ge1xuICAgICAgICBjb25zb2xlLmVycm9yKGVycm9yKTtcbiAgICAgICAgaWYgKGVycm9yLmVycikge1xuICAgICAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdChlcnJvci5lcnIpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdChlcnJvcik7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICB9XG5cbiAgYXN5bmMgX3Bvc3QodXJsOiBzdHJpbmcsIGRhdGE6IGFueSkge1xuICAgIC8vIGlmIHRoZSByZWdpb24gaXMgbm90IHNldCwgZ2V0IGl0IGZyb20gdGhlIGRhdGFzb3VyY2VcbiAgICBpZiAodHlwZW9mIHRoaXMucmVnaW9uID09PSAndW5kZWZpbmVkJykge1xuICAgICAgLy9jb25zb2xlLmxvZyhcImtlbnRpa0FQSS5fcG9zdDogdGhpcy5yZWdpb24gVU5ERUZJTkVELCBmZXRjaGluZ1wiKTtcbiAgICAgIGF3YWl0IHRoaXMuYmFja2VuZFNydi5nZXQoJy9hcGkvZGF0YXNvdXJjZXMnKS50aGVuKCAoYWxsRFM6IGFueSkgPT4ge1xuICAgICAgICB0aGlzLnNldFJlZ2lvbihnZXRSZWdpb24oYWxsRFMpKTtcbiAgICAgICAgLy9jb25zb2xlLmxvZyhcImtlbnRpa0FQSS5fcG9zdDogRkVUQ0hFRCByZWdpb24gXCIgKyB0aGlzLnJlZ2lvbik7XG4gICAgICB9KTtcbiAgICB9XG4gICAgcmV0dXJuIHRoaXMuYmFja2VuZFNydlxuICAgICAgLmRhdGFzb3VyY2VSZXF1ZXN0KHtcbiAgICAgICAgbWV0aG9kOiAnUE9TVCcsXG4gICAgICAgIHVybDogdGhpcy5iYXNlVXJsICsgXCIvXCIgKyB0aGlzLnJlZ2lvbiArIHVybCxcbiAgICAgICAgZGF0YTogZGF0YSxcbiAgICAgIH0pXG4gICAgICAudGhlbihyZXNwb25zZSA9PiB7XG4gICAgICAgIGlmIChyZXNwb25zZS5kYXRhKSB7XG4gICAgICAgICAgcmV0dXJuIHJlc3BvbnNlLmRhdGE7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgcmV0dXJuIFtdO1xuICAgICAgICB9XG4gICAgICB9KVxuICAgICAgLmNhdGNoKGVycm9yID0+IHtcbiAgICAgICAgY29uc29sZS5lcnJvcihlcnJvcik7XG4gICAgICAgIGlmIChlcnJvci5lcnIpIHtcbiAgICAgICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoZXJyb3IuZXJyKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoZXJyb3IpO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgfVxufVxuXG5hbmd1bGFyLm1vZHVsZSgnZ3JhZmFuYS5zZXJ2aWNlcycpLnNlcnZpY2UoJ2tlbnRpa0FQSVNydicsIEtlbnRpa0FQSSk7XG4iLCJpbXBvcnQgY29uZmlnVGVtcGxhdGUgZnJvbSAnLi9jb25maWcuaHRtbCc7XG5pbXBvcnQgeyBLZW50aWtBUEkgfSBmcm9tICcuLi9kYXRhc291cmNlL2tlbnRpa0FQSSc7XG5pbXBvcnQgeyBzaG93QWxlcnQsIHNob3dDdXN0b21BbGVydCB9IGZyb20gXCIuLi9kYXRhc291cmNlL2FsZXJ0SGVscGVyXCI7XG5cbmltcG9ydCAqIGFzIF8gZnJvbSAnbG9kYXNoJztcblxuY2xhc3MgS2VudGlrQ29uZmlnQ3RybCB7XG4gIGFwcEVkaXRDdHJsOiBhbnk7XG4gIGFwcE1vZGVsOiBhbnk7XG4gIGFwaVZhbGlkYXRlZDogYm9vbGVhbjtcbiAgYXBpRXJyb3I6IGJvb2xlYW47XG4gIGtlbnRpazogS2VudGlrQVBJO1xuICBzdGF0aWMgdGVtcGxhdGU6IGFueTtcbiAgcmVnaW9uVHlwZXMgPSBbXG4gICAgeyB2YWx1ZTogXCJkZWZhdWx0XCIsIHRleHQ6IFwiVVMgKGRlZmF1bHQpXCIgfSxcbiAgICB7IHZhbHVlOiBcImV1XCIsIHRleHQ6IFwiRVVcIiB9LFxuICAgIHsgdmFsdWU6IFwiY3VzdG9tXCIsIHRleHQ6IFwiQ3VzdG9tXCIgfVxuICBdO1xuXG4gIC8qKiBAbmdJbmplY3QgKi9cbiAgY29uc3RydWN0b3IoJHNjb3BlLCAkaW5qZWN0b3IsIHB1YmxpYyBiYWNrZW5kU3J2OiBhbnkpIHtcbiAgICB0aGlzLmFwcEVkaXRDdHJsLnNldFByZVVwZGF0ZUhvb2sodGhpcy5wcmVVcGRhdGUuYmluZCh0aGlzKSk7XG4gICAgdGhpcy5hcHBFZGl0Q3RybC5zZXRQb3N0VXBkYXRlSG9vayh0aGlzLnBvc3RVcGRhdGUuYmluZCh0aGlzKSk7XG5cbiAgICBpZiAoIXRoaXMuYXBwTW9kZWwuanNvbkRhdGEpIHtcbiAgICAgIHRoaXMuYXBwTW9kZWwuanNvbkRhdGEgPSB7fTtcbiAgICB9XG4gICAgaWYgKCF0aGlzLmFwcE1vZGVsLnNlY3VyZUpzb25EYXRhKSB7XG4gICAgICB0aGlzLmFwcE1vZGVsLnNlY3VyZUpzb25EYXRhID0ge307XG4gICAgfVxuICAgIGlmICh0eXBlb2YgdGhpcy5hcHBNb2RlbC5qc29uRGF0YS5yZWdpb24gPT09ICd1bmRlZmluZWQnKSB7XG4gICAgICB0aGlzLmFwcE1vZGVsLmpzb25EYXRhLnJlZ2lvbiA9IFwiZGVmYXVsdFwiO1xuICAgIH1cbiAgICB0aGlzLmFwaVZhbGlkYXRlZCA9IGZhbHNlO1xuICAgIHRoaXMuYXBpRXJyb3IgPSBmYWxzZTtcbiAgICB0aGlzLmtlbnRpayA9IG5ldyBLZW50aWtBUEkodGhpcy5iYWNrZW5kU3J2KTtcbiAgICB0aGlzLmtlbnRpay5zZXRSZWdpb24odGhpcy5hcHBNb2RlbC5qc29uRGF0YS5yZWdpb24pO1xuICAgIGlmICh0aGlzLmFwcE1vZGVsLmVuYWJsZWQgJiYgdGhpcy5hcHBNb2RlbC5qc29uRGF0YS50b2tlblNldCkge1xuICAgICAgdGhpcy52YWxpZGF0ZUFwaUNvbm5lY3Rpb24oKTtcbiAgICB9XG4gIH1cblxuICBwcmVVcGRhdGUoKSB7XG4gICAgaWYgKHRoaXMuYXBwTW9kZWwuc2VjdXJlSnNvbkRhdGEudG9rZW4pIHtcbiAgICAgIHRoaXMuYXBwTW9kZWwuanNvbkRhdGEudG9rZW5TZXQgPSB0cnVlO1xuICAgIH1cblxuICAgIHJldHVybiB0aGlzLmluaXREYXRhc291cmNlKCk7XG4gIH1cblxuICBhc3luYyBwb3N0VXBkYXRlKCkge1xuICAgIGlmICghdGhpcy5hcHBNb2RlbC5lbmFibGVkKSB7XG4gICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKCk7XG4gICAgfVxuXG4gICAgYXdhaXQgdGhpcy52YWxpZGF0ZUFwaUNvbm5lY3Rpb24oKTsgICAgXG4gICAgYXdhaXQgdGhpcy5hcHBFZGl0Q3RybC5pbXBvcnREYXNoYm9hcmRzKCk7XG5cbiAgICByZXR1cm4ge1xuICAgICAgdXJsOiAnZGFzaGJvYXJkL2RiL2tlbnRpay1ob21lJyxcbiAgICAgIG1lc3NhZ2U6ICdLZW50aWsgQ29ubmVjdCBQcm8gYXBwIGluc3RhbGxlZCEnLFxuICAgIH07XG4gIH1cblxuICAvLyBtYWtlIHN1cmUgdGhhdCB3ZSBjYW4gaGl0IHRoZSBLZW50aWsgQVBJLlxuICBhc3luYyB2YWxpZGF0ZUFwaUNvbm5lY3Rpb24oKSB7XG4gICAgdHJ5IHtcbiAgICAgIGxldCByZXN1bHQgPSBhd2FpdCB0aGlzLmtlbnRpay5nZXRVc2VycygpO1xuICAgICAgdHJ5IHtcbiAgICAgICAgaWYgKCByZXN1bHQuaGFzT3duUHJvcGVydHkoJ2RhdGEnKSApIHtcbiAgICAgICAgICB0aGlzLmFwaVZhbGlkYXRlZCA9IHRydWU7XG4gICAgICAgICAgc2hvd0N1c3RvbUFsZXJ0KCdBUEkgd29ya2luZyEnLCAnJywgJ3N1Y2Nlc3MnKTtcbiAgICAgICAgfVxuICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICBzaG93QWxlcnQoXCJVbmV4cGVjdGVkIHJlc3VsdCBmcm9tIEFQSTogXCIgKyBlKTtcbiAgICAgICAgdGhpcy5hcGlWYWxpZGF0ZWQgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5hcGlFcnJvciA9IHRydWU7XG4gICAgICB9XG4gICAgfSBjYXRjaCAoZSkge1xuICAgICAgc2hvd0FsZXJ0KGUpO1xuICAgICAgdGhpcy5hcGlWYWxpZGF0ZWQgPSBmYWxzZTtcbiAgICAgIHRoaXMuYXBpRXJyb3IgPSB0cnVlO1xuICAgIH1cbiAgfVxuXG4gIHJlc2V0KCkge1xuICAgIHRoaXMuYXBwTW9kZWwuanNvbkRhdGEuZW1haWwgPSAnJztcbiAgICB0aGlzLmFwcE1vZGVsLmpzb25EYXRhLnRva2VuU2V0ID0gZmFsc2U7XG4gICAgdGhpcy5hcHBNb2RlbC5qc29uRGF0YS5yZWdpb24gPSBcImRlZmF1bHRcIjtcbiAgICB0aGlzLmFwcE1vZGVsLmpzb25EYXRhLmR5bmFtaWNVcmwgPSBcIlwiO1xuICAgIHRoaXMuYXBwTW9kZWwuc2VjdXJlSnNvbkRhdGEgPSB7fTtcbiAgICB0aGlzLmFwaVZhbGlkYXRlZCA9IGZhbHNlO1xuICB9XG5cbiAgaW5pdERhdGFzb3VyY2UoKSB7XG4gICAgY29uc3Qgc2VsZiA9IHRoaXM7XG4gICAgLy9jaGVjayBmb3IgZXhpc3RpbmcgZGF0YXNvdXJjZS5cbiAgICByZXR1cm4gc2VsZi5iYWNrZW5kU3J2LmdldCgnL2FwaS9kYXRhc291cmNlcycpLnRoZW4ocmVzdWx0cyA9PiB7XG4gICAgICBsZXQgZm91bmRLZW50aWtEUyA9IGZhbHNlO1xuICAgICAgbGV0IHVwZGF0ZUtlbnRpa0RTID0gZmFsc2U7XG4gICAgICBsZXQgZHNJRCA9IE5hTjtcbiAgICAgIF8uZm9yRWFjaChyZXN1bHRzLCBkcyA9PiB7XG4gICAgICAgIC8vY29uc29sZS5sb2coXCJGb3VuZCBhIGRhdGFzb3VyY2UsIHR5cGUgaXM6IFwiICsgZHMudHlwZSk7XG4gICAgICAgIC8vIHVzZSB0aGUgdHlwZVxuICAgICAgICBpZiAoZHMudHlwZSA9PT0gJ2tlbnRpay1kcycpIHtcbiAgICAgICAgICBmb3VuZEtlbnRpa0RTID0gdHJ1ZTtcbiAgICAgICAgICBkc0lEID0gZHMuaWQ7XG4gICAgICAgICAgLy9jb25zb2xlLmxvZyhcImNvbmZpZy5pbml0RGF0YXNvdXJjZTogZm91bmQgZXhpc3RpbmcgZGF0YXNvdXJjZSB3aXRoIHJlZ2lvbjogXCIgKyBkcy5qc29uRGF0YS5yZWdpb24pO1xuICAgICAgICAgIHVwZGF0ZUtlbnRpa0RTID0gdHJ1ZTtcblxuICAgICAgICAgIGlmIChkcy5qc29uRGF0YS5yZWdpb24gIT09IHRoaXMuYXBwTW9kZWwuanNvbkRhdGEucmVnaW9uKSB7XG4gICAgICAgICAgICB1cGRhdGVLZW50aWtEUyA9IHRydWU7XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmIChkcy5qc29uRGF0YSAhPT0gdGhpcy5hcHBNb2RlbC5qc29uRGF0YSkge1xuICAgICAgICAgICAgdXBkYXRlS2VudGlrRFMgPSB0cnVlO1xuICAgICAgICAgIH1cbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgICAgY29uc3QgcHJvbWlzZXMgPSBbXTtcbiAgICAgIGlmICghZm91bmRLZW50aWtEUyB8fCB1cGRhdGVLZW50aWtEUykge1xuICAgICAgICAvLyBjcmVhdGUgZGF0YXNvdXJjZVxuICAgICAgICBjb25zdCBrZW50aWsgPSB7XG4gICAgICAgICAgbmFtZTogJ2tlbnRpaycsXG4gICAgICAgICAgdHlwZTogJ2tlbnRpay1kcycsXG4gICAgICAgICAgYWNjZXNzOiAncHJveHknLFxuICAgICAgICAgIGpzb25EYXRhOiBzZWxmLmFwcE1vZGVsLmpzb25EYXRhLFxuICAgICAgICB9O1xuICAgICAgICBpZiAodXBkYXRlS2VudGlrRFMpIHtcbiAgICAgICAgICBwcm9taXNlcy5wdXNoKHNlbGYuYmFja2VuZFNydi5wdXQoYC9hcGkvZGF0YXNvdXJjZXMvJHtkc0lEfWAsIGtlbnRpaykpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHByb21pc2VzLnB1c2goc2VsZi5iYWNrZW5kU3J2LnBvc3QoJy9hcGkvZGF0YXNvdXJjZXMnLCBrZW50aWspKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgLy8gdXBkYXRlIHJlcXVpcmVzIGEgUFVUIHdpdGggdGhlIGlkXG4gICAgICByZXR1cm4gUHJvbWlzZS5hbGwocHJvbWlzZXMpO1xuICAgIH0pO1xuICB9XG59XG5cbktlbnRpa0NvbmZpZ0N0cmwudGVtcGxhdGUgPSBjb25maWdUZW1wbGF0ZTtcblxuZXhwb3J0IHsgS2VudGlrQ29uZmlnQ3RybCBhcyBDb25maWdDdHJsIH07XG4iXSwic291cmNlUm9vdCI6IiJ9