{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///external \"lodash\"","webpack:///external \"angular\"","webpack:///./datasource/kentikAPI.ts","webpack:///./datasource/metric_def.ts","webpack:///./datasource/kentikProxy.ts","webpack:///./datasource/query_builder.ts","webpack:///./datasource/datasource.ts","webpack:///./datasource/config.ts","webpack:///./datasource/query_editor.ts","webpack:///./datasource/module.ts"],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","__WEBPACK_EXTERNAL_MODULE__0__","__WEBPACK_EXTERNAL_MODULE__1__","KentikAPI","backendSrv","this","baseUrl","$inject","resp","_a","sent","data","devices","getUsers","_get","getFieldValues","field","query","invokeSQLQuery","invokeTopXDataQuery","kentikV5Query","queries","bucketIndex","_post","url","datasourceRequest","method","catch","error","console","err","Promise","reject","then","response","showAlert","message","status","statusText","lodash__WEBPACK_IMPORTED_MODULE_1__","grafana_app_core_core__WEBPACK_IMPORTED_MODULE_0__","emit","metricList","text","unitList","outsort","gfUnit","gfAxisLabel","transform","row","i_duration","unit","rangeSeconds","gfAxislabel","filterFieldList","getUTCTimestamp","ts","Date","getTime","getTimezoneOffset","getHash","queryObj","external_lodash_","starting_time","ending_time","JSON","stringify","kentikProxy_KentikProxy","KentikProxy","kentikAPISrv","kentikAPI","cache","cacheUpdateInterval","requestCachingIntervals","1d","getDevices","_this","cachedQuery","hash","shouldInvoke","result","timestamp","log","resolve","kentikQuery","startingTime","parse","endingTime","queryRange","cacheStartingTime","cacheEndingTime","cachedQueryRange","maxRefreshInterval","interval","external_moment_","getMaxRefreshInterval","Math","abs","getCustomDimensions","customDimensions","map","dimension","values","_getDimensionPopulatorsValues","display_name","getSavedFilters","savedFilters","filter","filter_name","populators","reduce","populator","push","KENTIK_TIME_FORMAT","formatAggs","unitDef","column","fn","raw","sample_rate","rank","formatUniqueIpAggs","formatMetricAggs","convertToKentikFilter","filterObj","filterDef","operator","filterField","filterValue","convertToKentikSavedFilter","filter_id","id","is_not","query_builder","buildTopXdataQuery","options","range","from","utc","format","to","metric","matrixBy","cidr","cidr6","topx","depth","fastData","lookback_seconds","time_format","device_name","deviceNames","aggregates","filters_obj","kentikFilterGroups","filtersObj","connector","filterGroups","length","formatFilters","saved_filters","kentikSavedFilters","filters","savedFiltersList","kentikFilters","filterFieldListExtended","_i","filters_1","filterFieldDef","undefined","savedFilterDef","condition","toLowerCase","not","datasource_KentikDatasource","KentikDatasource","instanceSettings","templateSrv","kentikProxySrv","kentik","interpolateDeviceField","variable","multi","includeAll","targets","target","getAdhocFilters","convertToKentikFilterGroup","replace","queryOptions","processResponse","results","_getExtendedDimensionsList","extendedMetricList","processTableData","bucketData","metricDef","processTimeSeries","seriesList","endIndex","series","timeseries","timeSeries","flow","seriesName","datapoints","point","grafanaSeries","table","table_model_default","a","columns","tableFields","col","val","parseFloat","rows","metricFindQuery","datasource_generator","device","label","initialList","field_1","ConfigCtrl","templateUrl","b","__","KentikQueryCtrl","_super","$scope","$injector","queryModes","__webpack_exports__"],"mappings":"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","file":"datasource/module.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 15);\n","module.exports = __WEBPACK_EXTERNAL_MODULE__0__;","module.exports = __WEBPACK_EXTERNAL_MODULE__1__;","import { appEvents } from 'grafana/app/core/core';\n\nimport * as _ from 'lodash';\nimport angular from 'angular';\n\nexport class KentikAPI {\n  baseUrl: string;\n\n  /** @ngInject */\n  constructor(public backendSrv: any) {\n    this.baseUrl = 'api/plugin-proxy/kentik-app';\n  }\n\n  async getDevices() {\n    const resp = await this._get('/api/v5/devices');\n\n    if (resp.data && resp.data.devices) {\n      return resp.data.devices;\n    } else {\n      return [];\n    }\n  }\n\n  getUsers() {\n    return this._get('/api/v5/users');\n  }\n\n  getFieldValues(field: string) {\n    const query = `SELECT DISTINCT ${field} FROM all_devices ORDER BY ${field} ASC`;\n    return this.invokeSQLQuery(query);\n  }\n\n  async getCustomDimensions() {\n    const data = await this._get('/api/v5/customdimensions');\n    return data.data.customDimensions;\n  }\n\n  async getSavedFilters() {\n    const data = await this._get('/api/v5/saved-filters');\n    return data.data;\n  }\n\n  invokeTopXDataQuery(query: any) {\n    const kentikV5Query = {\n      queries: [{ query: query, bucketIndex: 0 }],\n    };\n\n    return this._post('/api/v5/query/topXdata', kentikV5Query);\n  }\n\n  invokeSQLQuery(query: any) {\n    const data = {\n      query: query,\n    };\n\n    return this._post('/api/v5/query/sql', data);\n  }\n\n  _get(url: string) {\n    return this.backendSrv\n      .datasourceRequest({\n        method: 'GET',\n        url: this.baseUrl + url,\n      })\n      .catch(error => {\n        console.error(error);\n        if (error.err) {\n          return Promise.reject(error.err);\n        } else {\n          return Promise.reject(error);\n        }\n      });\n  }\n\n  _post(url: string, data: any) {\n    return this.backendSrv\n      .datasourceRequest({\n        method: 'POST',\n        url: this.baseUrl + url,\n        data: data,\n      })\n      .then(response => {\n        if (response.data) {\n          return response.data;\n        } else {\n          return [];\n        }\n      })\n      .catch(error => {\n        console.error(error);\n        if (error.err) {\n          return Promise.reject(error.err);\n        } else {\n          return Promise.reject(error);\n        }\n      });\n  }\n}\n\nexport function showAlert(error) {\n  let message = '';\n  message += error.status ? `(${error.status}) ` : '';\n  message += error.statusText ? error.statusText + ': ' : '';\n  if (error.data && error.data.error) {\n    message += error.data.error;\n  } else if (error.err) {\n    message += error.err;\n  } else if (_.isString(error)) {\n    message += error;\n  }\n\n  appEvents.emit('alert-error', [\"Can't connect to Kentik API\", message]);\n}\n\nangular.module('grafana.services').service('kentikAPISrv', KentikAPI);\n","const metricList = [\n  { text: 'Traffic', value: 'Traffic', field: 'traffic' },\n  { text: 'TopFlow', value: 'TopFlow', field: 'TopFlow' },\n  { text: 'Top flow IP', value: 'TopFlowsIP', field: 'TopFlowsIP' },\n  { text: 'Source Country', value: 'Geography_src', field: 'src_geo' },\n  { text: 'Source Geo Region', value: 'src_geo_region', field: 'src_geo_region' },\n  { text: 'Source Geo City', value: 'src_geo_city', field: 'src_geo_city' },\n  { text: 'Source As Number', value: 'AS_src', field: 'src_as' },\n  { text: 'Source Interface', value: 'InterfaceID_src', field: 'input_port' },\n  { text: 'Source Port', value: 'Port_src', field: 'l4_src_port' },\n  { text: 'Source VLAN', value: 'VLAN_src', field: 'vlan_in' },\n  { text: 'Source IP/CIDR', value: 'IP_src', field: 'ipv4_src_addr' },\n  { text: 'Source MAC Address', value: 'src_eth_mac', field: 'src_eth_mac' },\n  { text: 'Source Route Prefix/LEN', value: 'src_route_prefix_len', field: 'src_route_prefix_len' },\n  { text: 'Source Route LEN', value: 'src_route_length', field: 'src_route_length' },\n  { text: 'Source BGP Community', value: 'src_bgp_community', field: 'src_bgp_community' },\n  { text: 'Source BGP AS_Path', value: 'src_bgp_aspath', field: 'src_bgp_aspath' },\n  { text: 'Source BGP Next Hop IP/CIDR', value: 'src_nexthop_ip', field: 'ipv4_src_next_hop' },\n  { text: 'Source Next Hop AS Number', value: 'src_nexthop_asn', field: 'src_nexthop_as' },\n  { text: 'Source 2nd BGP_HOP AS Number', value: 'src_second_asn', field: 'src_second_asn' },\n  { text: 'Source 3nd BGP_HOP AS Number', value: 'src_third_asn', field: 'src_third_asn' },\n  { text: 'Source Protocol:IP Port', value: 'src_proto_port', field: 'src_proto_port' },\n  { text: 'Destination Country', value: 'Geography_dst', field: 'dst_geo' },\n  { text: 'Destination Region', value: 'dst_geo_region', field: 'dst_geo_region' },\n  { text: 'Destination City', value: 'dst_geo_city', field: 'dst_geo_city' },\n  { text: 'Destination As Number', value: 'AS_dst', field: 'dst_as' },\n  { text: 'Destination Interface', value: 'InterfaceID_dst', field: 'output_port' },\n  { text: 'Destination Port', value: 'Port_dst', field: 'l4_dst_port' },\n  { text: 'Destination VLAN', value: 'VLAN_dst', field: 'vlan_out' },\n  { text: 'Destination IP/CIDR', value: 'IP_dst', field: 'ipv4_dst_addr' },\n  { text: 'Destination MAC Address', value: 'dst_eth_mac', field: 'dst_eth_mac' },\n  { text: 'Destination Route Prefix/LEN', value: 'dst_route_prefix_len', field: 'dst_route_prefix_len' },\n  { text: 'Destination Route LEN', value: 'dst_route_length', field: 'dst_route_length' },\n  { text: 'Destination BGP Community', value: 'dst_bgp_community', field: 'dst_bgp_community' },\n  { text: 'Destination BGP AS_Path', value: 'dst_bgp_aspath', field: 'dst_bgp_aspath' },\n  { text: 'Destination BGP Next Hop IP/CIDR', value: 'dst_nexthop_ip', field: 'ipv4_dst_next_hop' },\n  { text: 'Destination Next Hop AS Number', value: 'dst_nexthop_asn', field: 'dst_nexthop_as' },\n  { text: 'Destination 2nd BGP_HOP AS Number', value: 'dst_second_asn', field: 'dst_second_asn' },\n  { text: 'Destination 3nd BGP_HOP AS Number', value: 'dst_third_asn', field: 'dst_third_asn' },\n  { text: 'Destination Protocol:IP Port', value: 'dst_proto_port', field: 'dst_proto_port' },\n  { text: 'Full Device', value: 'i_device_id', field: 'i_device_id' },\n  { text: 'Full Site', value: 'i_device_site_name', field: 'i_device_site_name' },\n  { text: 'Full Protocol', value: 'Proto', field: 'protocl' },\n  { text: 'Full INET Family', value: 'inet_family', field: 'inet_family' },\n  { text: 'Full TOS', value: 'TOS', field: 'tos' },\n  { text: 'Full TCP flags', value: 'tcp_flags', field: 'tcp_flags' },\n  { text: 'AS Top Talkers', value: 'ASTopTalkers', field:'ASTopTalkers'},\n  { text: 'Interface Top Talkers', value: 'InterfaceTopTalkers', field: 'InterfaceTopTalkers' },\n  { text: 'Port to Port Talkers', value: 'PortPortTalkers', field: 'PortPortTalkers' },\n  { text: 'Region Top Talkers', value: 'RegionTopTalkers', field: 'RegionTopTalkers' },\n];\n\nfunction toBitsPerSecond(value, row) {\n  return value * 8 / row.i_duration;\n}\n\nfunction toPerSecondRate(value, row) {\n  return value / row.i_duration;\n}\n\nfunction totalToAvgPerSecond(value, row, rangeSeconds) {\n  return value / rangeSeconds;\n}\n\nfunction totalToBitsPerSecond(value, row, rangeSeconds) {\n  return value * 8 / rangeSeconds;\n}\n\nconst unitList = [\n  {\n    text: 'Bits/s',\n    value: 'bytes',\n    field: 'f_sum_both_bytes',\n    outsort: 'avg_both',\n    gfUnit: 'bps',\n    gfAxisLabel: 'Bits/s',\n    transform: toBitsPerSecond,\n    tableFields: [\n      { text: 'Avg', field: 'avg_both', unit: 'bps', transform: totalToBitsPerSecond },\n      { text: '95th Percentile', field: 'p95th_both', unit: 'bps' },\n      { text: 'Max', field: 'max_both', unit: 'bps' },\n    ],\n  },\n  {\n    text: 'Packets/s',\n    value: 'packets',\n    field: 'f_sum_both_pkts',\n    outsort: 'avg_both',\n    gfUnit: 'pps',\n    gfAxislabel: 'Packets/s',\n    transform: toPerSecondRate,\n    tableFields: [\n      { text: 'Avg', field: 'avg_both', unit: 'pps', transform: totalToAvgPerSecond },\n      { text: '95th Percentile', field: 'p95th_both', unit: 'pps' },\n      { text: 'Max', field: 'max_both', unit: 'pps' },\n    ],\n  },\n  {\n    text: 'Unique Src IPs',\n    value: 'unique_src_ip',\n    field: 'f_hll(inet_src_addr,0.0001)',\n    outsort: 'avg_ips',\n    gfUnit: 'short',\n    gfAxisLabel: 'Unique Src IPs',\n    tableFields: [\n      { text: 'Average', field: 'avg_ips', unit: 'none' },\n      { text: 'p95th', field: 'p95th_ips', unit: 'none' },\n      { text: 'Max', field: 'max_ips', unit: 'none' },\n      { text: 'p95th mbps', field: 'p95th_bits_per_sec', unit: 'bps' },\n      { text: 'p95th pps', field: 'p95th_pkts_per_sec', unit: 'pps' },\n    ],\n  },\n  {\n    text: 'Unique Dst IPs',\n    value: 'unique_dst_ip',\n    field: 'f_hll(inet_dst_addr,0.0001)',\n    outsort: 'avg_ips',\n    gfUnit: 'short',\n    gfAxisLabel: 'Unique Dst IPs',\n    tableFields: [\n      { text: 'Average', field: 'avg_ips', unit: 'none' },\n      { text: 'p95th', field: 'p95th_ips', unit: 'none' },\n      { text: 'Max', field: 'max_ips', unit: 'none' },\n      { text: 'p95th mbps', field: 'p95th_bits_per_sec', unit: 'bps' },\n      { text: 'p95th pps', field: 'p95th_pkts_per_sec', unit: 'pps' },\n    ],\n  },\n];\n\nconst filterFieldList = [\n  { text: 'Source City', field: 'src_geo_city' },\n  { text: 'Source Region', field: 'src_geo_region' },\n  { text: 'Source Country', field: 'src_geo' },\n  { text: 'Source AS Number', field: 'src_as' },\n  { text: 'Source AS Name', field: 'src_as_name' },\n  { text: 'Source Flow Tag', field: 'src_flow_tags' },\n  { text: 'Source IP Port', field: 'l4_src_port' },\n  { text: 'Source MAC Address', field: 'src_eth_mac' },\n  { text: 'Source VLAN', field: 'vlan_in' },\n  { text: 'Source IP Address', field: 'inet_src_addr' },\n  { text: 'Source Interface ID', field: 'input_port' },\n  { text: 'Source Interface Name', field: 'i_input_interface_description' },\n  { text: 'Source Interface Description', field: 'i_input_snmp_alias' },\n  { text: 'Source Route Prefix', field: 'ipv4_src_route_prefix' },\n  { text: 'Source Route LEN', field: 'src_route_length' },\n  { text: 'Source BGP AS_PATH', field: 'src_bgp_aspath' },\n  { text: 'Source BGP Community', field: 'src_bgp_community' },\n  { text: 'Source Next Hop IP/CIDR', field: 'ipv4_src_next_hop' },\n  { text: 'Source Next Hop AS Number', field: 'src_nexthop_as' },\n  { text: 'Source Next Hop AS Name', field: 'src_nexthop_as_name' },\n  { text: 'Source 2nd BGP_HOP AS Number', field: 'src_second_asn' },\n  { text: 'Source 2nd BGP_HOP AS Name', field: 'src_second_asn_name' },\n  { text: 'Source 3nd BGP_HOP AS Number', field: 'src_third_asn' },\n  { text: 'Source 3nd BGP_HOP AS Name', field: 'src_third_asn_name' },\n  { text: 'Destination City', field: 'dst_geo_city' },\n  { text: 'Destination Region', field: 'dst_geo_region' },\n  { text: 'Destination Country', field: 'dst_geo' },\n  { text: 'Destination AS Number', field: 'dst_as' },\n  { text: 'Destination AS Name', field: 'dst_as_name' },\n  { text: 'Destination Flow Tag', field: 'dst_flow_tags' },\n  { text: 'Destination IP Port', field: 'l4_dst_port' },\n  { text: 'Destination MAC Address', field: 'dst_eth_mac' },\n  { text: 'Destination VLAN', field: 'vlan_out' },\n  { text: 'Destination IP Address', field: 'inet_dst_addr' },\n  { text: 'Destination Interface ID', field: 'output_port' },\n  { text: 'Destination Interface Name', field: 'i_output_interface_description' },\n  { text: 'Destination Interface Description', field: 'i_output_snmp_alias' },\n  { text: 'Destination Route Prefix', field: 'ipv4_dst_route_prefix' },\n  { text: 'Destination Route LEN', field: 'dst_route_length' },\n  { text: 'Destination BGP AS_PATH', field: 'dst_bgp_aspath' },\n  { text: 'Destination BGP Community', field: 'dst_bgp_community' },\n  { text: 'Destination Next Hop IP/CIDR', field: 'ipv4_dst_next_hop' },\n  { text: 'Destination Next Hop AS Number', field: 'dst_nexthop_as' },\n  { text: 'Destination Next Hop AS Name', field: 'dst_nexthop_as_name' },\n  { text: 'Destination 2nd BGP_HOP AS Number', field: 'dst_second_asn' },\n  { text: 'Destination 2nd BGP_HOP AS Name', field: 'dst_second_asn_name' },\n  { text: 'Destination 3nd BGP_HOP AS Number', field: 'dst_third_asn' },\n  { text: 'Destination 3nd BGP_HOP AS Name', field: 'dst_third_asn_name' },\n  { text: 'TCP Flags', field: 'tcp_flags' },\n  { text: 'TCP Flags (raw)', field: 'tcp_flags_raw' },\n  { text: 'Protocol', field: 'protocol' },\n  // {text: 'Protocol Name', field: 'i_protocol_name'},\n  { text: 'INET Family', field: 'inet_family' },\n  { text: 'Device Name', field: 'i_device_name' },\n  { text: 'TCP Retransmits', field: 'tcp_retransmit' },\n  { text: 'TOS/Diffserv', field: 'tos' },\n  { text: 'Per-flow packets (both in and out)', field: 'both_pkts' },\n  { text: 'Per-flow packets (recorded inbound)', field: 'in_pkts' },\n  { text: 'Per-flow bytes (recorded inbound)', field: 'in_bytes' },\n  { text: 'Per-flow packets (recorded outbound)', field: 'out_pkts' },\n  { text: 'Per-flow bytes (recorded outbound)', field: 'out_bytes' },\n];\n\nexport { metricList, unitList, filterFieldList };\n","import angular from 'angular';\nimport * as _ from 'lodash';\nimport * as moment from 'moment';\nimport './kentikAPI';\n\nfunction getUTCTimestamp() {\n  const ts = new Date();\n  return ts.getTime() + ts.getTimezoneOffset() * 60 * 1000;\n}\n\n// Get hash of Kentik query\nfunction getHash(queryObj: any) {\n  const query = _.cloneDeep(queryObj);\n  query.starting_time = null;\n  query.ending_time = null;\n  return JSON.stringify(query);\n}\n\n// Prevent too frequent queries\nfunction getMaxRefreshInterval(query: any) {\n  const interval: any = Date.parse(query.ending_time) - Date.parse(query.starting_time);\n  if (interval > moment.duration(1, 'months')) {\n    return 60 * 60 * 1000; // 1 hour\n  } else if (interval > moment.duration(1, 'day')) {\n    return 15 * 60 * 1000; // 15 min\n  } else {\n    return 5 * 60 * 1000; // 5 min\n  }\n}\n\nexport class KentikProxy {\n  kentikAPI: any;\n  cache: any;\n  cacheUpdateInterval: number;\n  requestCachingIntervals: { '1d': number };\n  getDevices: () => Promise<any[]>;\n\n  /** @ngInject */\n  constructor(backendSrv, kentikAPISrv: any) {\n    this.kentikAPI = kentikAPISrv;\n    this.cache = {};\n    this.cacheUpdateInterval = 5 * 60 * 1000; // 5 min by default\n    this.requestCachingIntervals = {\n      '1d': 0,\n    };\n\n    this.getDevices = this.kentikAPI.getDevices.bind(this.kentikAPI);\n  }\n\n  invokeTopXDataQuery(query: any) {\n    const cachedQuery = _.cloneDeep(query);\n    const hash = getHash(cachedQuery);\n\n    if (this.shouldInvoke(query)) {\n      // Invoke query\n      return this.kentikAPI.invokeTopXDataQuery(query).then(result => {\n        const timestamp = getUTCTimestamp();\n\n        this.cache[hash] = {\n          timestamp: timestamp,\n          query: cachedQuery,\n          result: result,\n        };\n        console.log('Invoke Kentik query');\n        return result;\n      });\n    } else {\n      // Get from cache\n      console.log('Get result from cache');\n      return Promise.resolve(this.cache[hash].result);\n    }\n  }\n\n  // Decide, is query shold be invoked or get data from cahce?\n  shouldInvoke(query: any) {\n    const kentikQuery = query;\n    const hash = getHash(kentikQuery);\n    const timestamp = getUTCTimestamp();\n\n    const startingTime = Date.parse(kentikQuery.starting_time);\n    const endingTime = Date.parse(kentikQuery.ending_time);\n    const queryRange = endingTime - startingTime;\n\n    const cacheStartingTime = this.cache[hash] ? Date.parse(this.cache[hash].query.starting_time) : null;\n    const cacheEndingTime = this.cache[hash] ? Date.parse(this.cache[hash].query.ending_time) : null;\n    const cachedQueryRange = cacheEndingTime - cacheStartingTime;\n\n    const maxRefreshInterval = getMaxRefreshInterval(kentikQuery);\n\n    return (\n      !this.cache[hash] ||\n      timestamp - endingTime > maxRefreshInterval ||\n      (this.cache[hash] &&\n        (timestamp - cacheEndingTime > maxRefreshInterval ||\n          startingTime < cacheStartingTime ||\n          Math.abs(queryRange - cachedQueryRange) > 60 * 1000)) // is time range changed?\n    );\n  }\n\n  getFieldValues(field: string) {\n    let ts = getUTCTimestamp();\n    if (this.cache[field] && ts - this.cache[field].ts < this.cacheUpdateInterval) {\n      return Promise.resolve(this.cache[field].value);\n    } else {\n      return this.kentikAPI.getFieldValues(field).then(result => {\n        ts = getUTCTimestamp();\n        this.cache[field] = {\n          ts: ts,\n          value: result,\n        };\n\n        return result;\n      });\n    }\n  }\n\n  async getCustomDimensions() {\n    if (this.cache.customDimensions === undefined) {\n      const customDimensions = await this.kentikAPI.getCustomDimensions();\n      this.cache.customDimensions = customDimensions.map(dimension => ({\n        values: this._getDimensionPopulatorsValues(dimension),\n        text: `Custom ${dimension.display_name}`,\n        value: dimension.name,\n        field: dimension.name\n      }));\n    }\n    return this.cache.customDimensions;\n  }\n\n  async getSavedFilters() {\n    if (this.cache.savedFilters === undefined) {\n      const savedFilters = await this.kentikAPI.getSavedFilters();\n      this.cache.savedFilters = _.map(savedFilters, filter => ({\n        text: `Saved ${filter.filter_name}`,\n        field: filter.filter_name,\n        id: filter.id\n      }));\n    }\n    return this.cache.savedFilters;\n  }\n\n  private _getDimensionPopulatorsValues(dimension: any) {\n    return dimension.populators.reduce((values, populator) => {\n      values.push(populator.value);\n      return values;\n    }, []);\n  }\n}\n\nangular.module('grafana.services').service('kentikProxySrv', KentikProxy);\n","import * as _ from 'lodash';\nimport { unitList, filterFieldList } from './metric_def';\n\nconst KENTIK_TIME_FORMAT = 'YYYY-MM-DD HH:mm:ss';\n\nfunction formatMetricAggs(unitDef: any) {\n  const aggs = [\n    {\n      name: 'avg_both',\n      column: unitDef.field,\n      fn: 'average',\n      raw: true, // Set to get timeseries data\n      sample_rate: 1,\n    },\n    {\n      name: 'p95th_both',\n      column: unitDef.field,\n      fn: 'percentile',\n      rank: 95,\n      sample_rate: 1,\n    },\n    {\n      name: 'max_both',\n      column: unitDef.field,\n      fn: 'max',\n      sample_rate: 1,\n    },\n  ];\n\n  return aggs;\n}\n\nfunction formatUniqueIpAggs(unitDef: any) {\n  const aggs = [\n    {\n      name: 'avg_ips',\n      column: unitDef.field,\n      fn: 'average',\n      raw: true,\n      sample_rate: 1,\n    },\n    {\n      name: 'p95th_ips',\n      column: unitDef.field,\n      fn: 'percentile',\n      rank: 95,\n      sample_rate: 1,\n    },\n    {\n      name: 'max_ips',\n      column: unitDef.field,\n      fn: 'max',\n      sample_rate: 1,\n      raw: true,\n    },\n    {\n      name: 'p95th_bits_per_sec',\n      column: 'f_sum_both_bytes',\n      fn: 'percentile',\n      rank: 95,\n      sample_rate: 1,\n    },\n    {\n      name: 'p95th_pkts_per_sec',\n      column: 'f_sum_both_pkts',\n      fn: 'percentile',\n      rank: 95,\n      sample_rate: 1,\n    },\n  ];\n\n  return aggs;\n}\n\nfunction formatAggs(unitDef: any) {\n  let aggs = [];\n  if (unitDef.value === 'unique_src_ip' || unitDef.value === 'unique_dst_ip') {\n    aggs = formatUniqueIpAggs(unitDef);\n  } else {\n    aggs = formatMetricAggs(unitDef);\n  }\n\n  return aggs;\n}\n\nfunction formatFilters(kentikFilterGroups: Array<any>) {\n  const filtersObj = {\n    connector: 'All',\n    filterGroups: [],\n  };\n\n  if (kentikFilterGroups.length) {\n    filtersObj.filterGroups = kentikFilterGroups;\n  }\n\n  return filtersObj;\n}\n\nfunction buildTopXdataQuery(options) {\n  const unitDef = _.find(unitList, { value: options.unit });\n  const startingTime = options.range.from.utc().format(KENTIK_TIME_FORMAT);\n  const endingTime = options.range.to.utc().format(KENTIK_TIME_FORMAT);\n\n  const query = {\n    dimension: [options.metric],\n    metric: options.unit,\n    matrixBy: [],\n    cidr: 32,\n    cidr6: 128,\n    topx: '8', // Visualization depth (8 by default)\n    depth: 100,\n    fastData: 'Auto',\n    lookback_seconds: 0,\n    time_format: 'UTC',\n    starting_time: startingTime,\n    ending_time: endingTime,\n    device_name: options.deviceNames,\n    outsort: unitDef.outsort,\n    aggregates: formatAggs(unitDef),\n    filters_obj: formatFilters(options.kentikFilterGroups),\n    saved_filters: options.kentikSavedFilters,\n  };\n\n  return query;\n}\n\nfunction convertToKentikFilter(filterObj: any, filterDef: any) {\n  // Use Kentik 'not equal' style\n  if (filterObj.operator === '!=') {\n    filterObj.operator = '<>';\n  }\n\n  return {\n    filterField: filterDef.field,\n    operator: filterObj.operator,\n    filterValue: filterObj.value,\n  };\n}\n\nfunction convertToKentikSavedFilter(filterObj: any, filterDef: any) {\n  return {\n    filter_id: filterDef.id,\n    is_not: filterObj.value === 'exclude'\n  };\n}\n\nfunction convertToKentikFilterGroup(filters: Array<any>, customDimensions: Array<any>, savedFiltersList: Array<any>) {\n  let kentikFilters = [];\n  let savedFilters = [];\n\n  if (filters.length) {\n    const filterFieldListExtended = _.concat(filterFieldList, customDimensions);\n    for (let filter of filters) {\n      const filterFieldDef = _.find(filterFieldListExtended, { text: filter.key });\n      if (filterFieldDef === undefined) {\n        const savedFilterDef = _.find(savedFiltersList, { text: filter.key });\n        savedFilters.push(convertToKentikSavedFilter(filter, savedFilterDef));\n      } else {\n        kentikFilters.push(convertToKentikFilter(filter, filterFieldDef));\n      }\n    }\n\n\n    if (kentikFilters.length > 0) {\n      let connector = 'All';\n      if (\n        filters[0].condition &&\n        (filters[0].condition.toLowerCase() === 'or' || filters[0].condition.toLowerCase() === 'any')\n      ) {\n        connector = 'Any';\n      }\n\n      kentikFilters = [{\n        connector,\n        filters: kentikFilters,\n        not: false,\n      }];\n    }\n  }\n\n  return {\n    kentikFilters,\n    savedFilters,\n  };\n}\n\nexport default {\n  buildTopXdataQuery,\n  formatAggs,\n  convertToKentikFilterGroup,\n};\n","import { metricList, unitList, filterFieldList } from './metric_def';\nimport * as _ from 'lodash';\nimport './kentikProxy';\nimport TableModel from 'grafana/app/core/table_model';\nimport queryBuilder from './query_builder';\n\nclass KentikDatasource {\n  name: string;\n  kentik: any;\n\n  /** @ngInject */\n  constructor(public instanceSettings: any, public templateSrv: any, kentikProxySrv: any) {\n    this.name = instanceSettings.name;\n    this.kentik = kentikProxySrv;\n  }\n\n  interpolateDeviceField(value: any, variable: any) {\n    // if no multi or include all do not regexEscape\n    if (!variable.multi && !variable.includeAll) {\n      return value;\n    }\n\n    if (typeof value === 'string') {\n      return value;\n    }\n\n    return value.join(',');\n  }\n\n  async query(options: any) {\n    if (!options.targets || options.targets.length === 0) {\n      return Promise.resolve({ data: [] });\n    }\n\n    const target = options.targets[0];\n    const deviceNames = this.templateSrv.replace(\n      target.device,\n      options.scopedVars,\n      this.interpolateDeviceField.bind(this)\n    );\n\n    let kentikFilters = this.templateSrv.getAdhocFilters(this.name);\n    const customDimensions = await this.kentik.getCustomDimensions();\n    const savedFiltersList = await this.kentik.getSavedFilters();\n    const kentikFilterGroups = queryBuilder.convertToKentikFilterGroup(kentikFilters, customDimensions, savedFiltersList);\n\n    const queryOptions = {\n      deviceNames: deviceNames,\n      range: {\n        from: options.range.from,\n        to: options.range.to,\n      },\n      metric: this.templateSrv.replace(target.metric),\n      unit: this.templateSrv.replace(target.unit),\n      kentikFilterGroups: kentikFilterGroups.kentikFilters,\n      kentikSavedFilters: kentikFilterGroups.savedFilters,\n    };\n    const query = queryBuilder.buildTopXdataQuery(queryOptions);\n\n    return this.kentik\n      .invokeTopXDataQuery(query)\n      .then(this.processResponse.bind(this, query, target.mode, options))\n      .then(result => {\n        return {\n          data: result,\n        };\n      });\n  }\n\n  async processResponse(query: any, mode: string, options: any, data: any) {\n    if (!data.results) {\n      return Promise.reject({ message: 'no kentik data' });\n    }\n\n    const bucketData = data.results[0].data;\n    if (bucketData.length === 0) {\n      return [];\n    }\n\n    const extendedMetricList = await this._getExtendedDimensionsList(metricList);\n    const metricDef = _.find(\n      extendedMetricList,\n      { value: query.dimension[0] }\n    );\n\n    const unitDef = _.find(unitList, { value: query.metric });\n\n    if (mode === 'table') {\n      return this.processTableData(bucketData, metricDef, unitDef);\n    } else {\n      return this.processTimeSeries(bucketData, query, options);\n    }\n  }\n\n  processTimeSeries(bucketData: any, query: any, options?: any) {\n    const seriesList = [];\n    let endIndex = query.topx;\n    if (bucketData.length < endIndex) {\n      endIndex = bucketData.length;\n    }\n\n    for (let i = 0; i < endIndex; i++) {\n      const series = bucketData[i];\n      const timeseries = _.find(series.timeSeries, series => {\n        return series.flow && series.flow.length;\n      });\n      const seriesName = series.key;\n\n      if (timeseries) {\n        const grafanaSeries = {\n          target: seriesName,\n          datapoints: _.map(timeseries.flow, point => {\n            return [point[1], point[0]];\n          }),\n        };\n        seriesList.push(grafanaSeries);\n      }\n    }\n\n    return seriesList;\n  }\n\n  processTableData(bucketData: any, metricDef: any, unitDef: any) {\n    const table = new TableModel();\n\n    table.columns.push({ text: metricDef.text });\n\n    for (const col of unitDef.tableFields) {\n      table.columns.push({ text: col.text, unit: col.unit });\n    }\n\n    _.forEach(bucketData, row => {\n      const seriesName = row.key;\n\n      const values = [seriesName];\n      for (const col of unitDef.tableFields) {\n        let val = row[col.field];\n\n        if (_.isString(val)) {\n          val = parseFloat(val);\n        }\n\n        values.push(val);\n      }\n\n      table.rows.push(values);\n    });\n\n    return [table];\n  }\n\n  async metricFindQuery(query: any) {\n    if (query === 'metrics()') {\n      return this._getExtendedDimensionsList(metricList);\n    }\n    if (query === 'units()') {\n      return unitList;\n    }\n\n    return this.kentik.getDevices().then(devices => {\n      return devices.map(device => {\n        return { text: device.device_name, value: device.device_name };\n      });\n    });\n  }\n\n  async getTagKeys() {\n    let initialList = await this._getExtendedDimensionsList(filterFieldList);\n    const savedFilters = await this.kentik.getSavedFilters();\n    return _.concat(initialList, savedFilters);\n  }\n\n  async getTagValues(options: any) {\n    if (options) {\n      let filter = _.find(filterFieldList, { text: options.key });\n\n      if (filter === undefined) {\n        const savedFilters = await this.kentik.getSavedFilters();\n        filter = _.find(savedFilters, { text: options.key });\n        if (filter === undefined) {\n          const customDimensions = await this.kentik.getCustomDimensions();\n          const dimension = _.find(customDimensions, { text: options.key });\n          return dimension.values.map(value => ({ text: value }));\n        } else {\n          return [{ text: 'include' }, { text: 'exclude' }];\n        }\n      } else {\n        const field = filter.field;\n        return this.kentik.getFieldValues(field).then(result => {\n          return result.rows.map(row => {\n            return { text: row[field].toString() };\n          });\n        });\n      }\n    } else {\n      return [];\n    }\n  }\n\n  private async _getExtendedDimensionsList(list: Array<any>) {\n    const customDimensions = await this.kentik.getCustomDimensions();\n    return _.concat(list, customDimensions);\n  }\n}\n\nexport { KentikDatasource };\n","export class ConfigCtrl {\n  static templateUrl = 'datasource/config.html';\n}\n","import { QueryCtrl } from 'grafana/app/plugins/sdk';\n\nclass KentikQueryCtrl extends QueryCtrl {\n  static templateUrl: string;\n  queryModes: any[];\n\n  /** @ngInject */\n  constructor($scope, $injector) {\n    super($scope, $injector);\n\n    this.target.mode = this.target.mode || 'graph';\n\n    this.queryModes = [{ value: 'graph', text: 'Graph' }, { value: 'table', text: 'Table' }];\n  }\n}\n\nKentikQueryCtrl.templateUrl = 'datasource/query_editor.html';\n\nexport { KentikQueryCtrl };\n","import {KentikDatasource} from './datasource';\nimport {ConfigCtrl} from './config';\nimport {KentikQueryCtrl} from './query_editor';\n\nexport {\n  KentikDatasource as Datasource,\n  ConfigCtrl as ConfigCtrl,\n  KentikQueryCtrl as QueryCtrl\n};\n"],"sourceRoot":""}