define(["lodash","app/plugins/sdk","angular","moment","app/core/table_model"],function(t,e,n,r,i){return function(t){var e={};function n(r){if(e[r])return e[r].exports;var i=e[r]={i:r,l:!1,exports:{}};return t[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)n.d(r,i,function(e){return t[e]}.bind(null,i));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=13)}([function(e,n){e.exports=t},function(t,n){t.exports=e},function(t,e){t.exports=n},,,,,,function(t,e){t.exports=r},function(t,e){t.exports=i},,,,function(t,e,n){"use strict";n.r(e);var r=[{text:"Traffic",value:"Traffic",field:"traffic"},{text:"Source Country",value:"Geography_src",field:"src_geo"},{text:"Source Geo Region",value:"src_geo_region",field:"src_geo_region"},{text:"Source Geo City",value:"src_geo_city",field:"src_geo_city"},{text:"Source As Number",value:"AS_src",field:"src_as"},{text:"Source Interface",value:"InterfaceID_src",field:"input_port"},{text:"Source Port",value:"Port_src",field:"l4_src_port"},{text:"Source VLAN",value:"VLAN_src",field:"vlan_in"},{text:"Source IP/CIDR",value:"IP_src",field:"ipv4_src_addr"},{text:"Source Route Prefix/LEN",value:"src_route_prefix_len",field:"src_route_prefix_len"},{text:"Source Route LEN",value:"src_route_length",field:"src_route_length"},{text:"Source BGP Community",value:"src_bgp_community",field:"src_bgp_community"},{text:"Source BGP AS_Path",value:"src_bgp_aspath",field:"src_bgp_aspath"},{text:"Source BGP Next Hop IP/CIDR",value:"src_nexthop_ip",field:"ipv4_src_next_hop"},{text:"Source Next Hop AS Number",value:"src_nexthop_asn",field:"src_nexthop_as"},{text:"Source 2nd BGP_HOP AS Number",value:"src_second_asn",field:"src_second_asn"},{text:"Source 3nd BGP_HOP AS Number",value:"src_third_asn",field:"src_third_asn"},{text:"Source Protocol:IP Port",value:"src_proto_port",field:"src_proto_port"},{text:"Destination Country",value:"Geography_dst",field:"dst_geo"},{text:"Destination Region",value:"dst_geo_region",field:"dst_geo_region"},{text:"Destination City",value:"dst_geo_city",field:"dst_geo_city"},{text:"Destination As Number",value:"AS_dst",field:"dst_as"},{text:"Destination Interface",value:"InterfaceID_dst",field:"output_port"},{text:"Destination Port",value:"Port_dst",field:"l4_dst_port"},{text:"Destination VLAN",value:"VLAN_dst",field:"vlan_out"},{text:"Destination IP/CIDR",value:"IP_dst",field:"ipv4_dst_addr"},{text:"Destination Route Prefix/LEN",value:"dst_route_prefix_len",field:"dst_route_prefix_len"},{text:"Destination Route LEN",value:"dst_route_prefix_len",field:"dst_route_length"},{text:"Destination BGP Community",value:"dst_bgp_community",field:"dst_bgp_community"},{text:"Destination BGP AS_Path",value:"dst_bgp_aspath",field:"dst_bgp_aspath"},{text:"Destination BGP Next Hop IP/CIDR",value:"dst_nexthop_ip",field:"ipv4_dst_next_hop"},{text:"Destination Next Hop AS Number",value:"dst_nexthop_asn",field:"dst_nexthop_as"},{text:"Destination 2nd BGP_HOP AS Number",value:"dst_second_asn",field:"dst_second_asn"},{text:"Destination 3nd BGP_HOP AS Number",value:"dst_third_asn",field:"dst_third_asn"},{text:"Destination Protocol:IP Port",value:"dst_proto_port",field:"dst_proto_port"},{text:"Full TOS",value:"TOS",field:"tos"},{text:"Full Protocol",value:"Proto",field:"protocl"}];var i=[{text:"Bits/s",value:"bytes",field:"f_sum_both_bytes",outsort:"avg_both",gfUnit:"bps",gfAxisLabel:"Bits/s",transform:function(t,e){return 8*t/e.i_duration},tableFields:[{text:"Avg",field:"avg_both",unit:"bps",transform:function(t,e,n){return 8*t/n}},{text:"95th Percentile",field:"p95th_both",unit:"bps"},{text:"Max",field:"max_both",unit:"bps"}]},{text:"Packets/s",value:"packets",field:"f_sum_both_pkts",outsort:"avg_both",gfUnit:"pps",gfAxislabel:"Packets/s",transform:function(t,e){return t/e.i_duration},tableFields:[{text:"Avg",field:"avg_both",unit:"pps",transform:function(t,e,n){return t/n}},{text:"95th Percentile",field:"p95th_both",unit:"pps"},{text:"Max",field:"max_both",unit:"pps"}]},{text:"Unique Src IPs",value:"unique_src_ip",field:"f_hll(inet_src_addr,0.0001)",outsort:"avg_ips",gfUnit:"short",gfAxisLabel:"Unique Src IPs",tableFields:[{text:"Average",field:"avg_ips",unit:"none"},{text:"p95th",field:"p95th_ips",unit:"none"},{text:"Max",field:"max_ips",unit:"none"},{text:"p95th mbps",field:"p95th_bits_per_sec",unit:"bps"},{text:"p95th pps",field:"p95th_pkts_per_sec",unit:"pps"}]},{text:"Unique Dst IPs",value:"unique_dst_ip",field:"f_hll(inet_dst_addr,0.0001)",outsort:"avg_ips",gfUnit:"short",gfAxisLabel:"Unique Dst IPs",tableFields:[{text:"Average",field:"avg_ips",unit:"none"},{text:"p95th",field:"p95th_ips",unit:"none"},{text:"Max",field:"max_ips",unit:"none"},{text:"p95th mbps",field:"p95th_bits_per_sec",unit:"bps"},{text:"p95th pps",field:"p95th_pkts_per_sec",unit:"pps"}]}],o=[{text:"Source City",field:"src_geo_city"},{text:"Source Region",field:"src_geo_region"},{text:"Source Country",field:"src_geo"},{text:"Source AS Number",field:"src_as"},{text:"Source AS Name",field:"src_as_name"},{text:"Source Flow Tag",field:"src_flow_tags"},{text:"Source IP Port",field:"l4_src_port"},{text:"Source MAC Address",field:"src_eth_mac"},{text:"Source VLAN",field:"vlan_in"},{text:"Source IP Address",field:"inet_src_addr"},{text:"Source Interface ID",field:"input_port"},{text:"Source Interface Name",field:"i_input_interface_description"},{text:"Source Interface Description",field:"i_input_snmp_alias"},{text:"Source Route Prefix",field:"ipv4_src_route_prefix"},{text:"Source Route LEN",field:"src_route_length"},{text:"Source BGP AS_PATH",field:"src_bgp_aspath"},{text:"Source BGP Community",field:"src_bgp_community"},{text:"Source Next Hop IP/CIDR",field:"ipv4_src_next_hop"},{text:"Source Next Hop AS Number",field:"src_nexthop_as"},{text:"Source Next Hop AS Name",field:"src_nexthop_as_name"},{text:"Source 2nd BGP_HOP AS Number",field:"src_second_asn"},{text:"Source 2nd BGP_HOP AS Name",field:"src_second_asn_name"},{text:"Source 3nd BGP_HOP AS Number",field:"src_third_asn"},{text:"Source 3nd BGP_HOP AS Name",field:"src_third_asn_name"},{text:"Destination City",field:"dst_geo_city"},{text:"Destination Region",field:"dst_geo_region"},{text:"Destination Country",field:"dst_geo"},{text:"Destination AS Number",field:"dst_as"},{text:"Destination AS Name",field:"dst_as_name"},{text:"Destination Flow Tag",field:"dst_flow_tags"},{text:"Destination IP Port",field:"l4_dst_port"},{text:"Destination MAC Address",field:"dst_eth_mac"},{text:"Destination VLAN",field:"vlan_out"},{text:"Destination IP Address",field:"inet_dst_addr"},{text:"Destination Interface ID",field:"output_port"},{text:"Destination Interface Name",field:"i_output_interface_description"},{text:"Destination Interface Description",field:"i_output_snmp_alias"},{text:"Destination Route Prefix",field:"ipv4_dst_route_prefix"},{text:"Destination Route LEN",field:"dst_route_length"},{text:"Destination BGP AS_PATH",field:"dst_bgp_aspath"},{text:"Destination BGP Community",field:"dst_bgp_community"},{text:"Destination Next Hop IP/CIDR",field:"ipv4_dst_next_hop"},{text:"Destination Next Hop AS Number",field:"dst_nexthop_as"},{text:"Destination Next Hop AS Name",field:"dst_nexthop_as_name"},{text:"Destination 2nd BGP_HOP AS Number",field:"dst_second_asn"},{text:"Destination 2nd BGP_HOP AS Name",field:"dst_second_asn_name"},{text:"Destination 3nd BGP_HOP AS Number",field:"dst_third_asn"},{text:"Destination 3nd BGP_HOP AS Name",field:"dst_third_asn_name"},{text:"TCP Flags",field:"tcp_flags"},{text:"TCP Flags (raw)",field:"tcp_flags_raw"},{text:"Protocol",field:"protocol"},{text:"INET Family",field:"inet_family"},{text:"Device Name",field:"i_device_name"},{text:"TCP Retransmits",field:"tcp_retransmit"},{text:"TOS/Diffserv",field:"tos"},{text:"Per-flow packets (both in and out)",field:"both_pkts"},{text:"Per-flow packets (recorded inbound)",field:"in_pkts"},{text:"Per-flow bytes (recorded inbound)",field:"in_bytes"},{text:"Per-flow packets (recorded outbound)",field:"out_pkts"},{text:"Per-flow bytes (recorded outbound)",field:"out_bytes"}],s=n(0),a=n.n(s),u=n(2),c=n.n(u),l=n(8),f=n.n(l),d=function(t,e,n,r){return new(n||(n=Promise))(function(i,o){function s(t){try{u(r.next(t))}catch(t){o(t)}}function a(t){try{u(r.throw(t))}catch(t){o(t)}}function u(t){t.done?i(t.value):new n(function(e){e(t.value)}).then(s,a)}u((r=r.apply(t,e||[])).next())})},p=function(t,e){var n,r,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,r=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(i=(i=s.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=e.call(t,s)}catch(t){o=[6,t],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}},_=function(){function t(t){this.backendSrv=t,this.baseUrl="api/plugin-proxy/kentik-app"}return t.$inject=["backendSrv"],t.prototype.getDevices=function(){return this._get("/api/v5/devices").then(function(t){return t.data&&t.data.devices?t.data.devices:[]})},t.prototype.getFieldValues=function(t){var e="SELECT DISTINCT "+t+" FROM all_devices ORDER BY "+t+" ASC";return this.invokeSQLQuery(e)},t.prototype.getCustomDimensions=function(){return d(this,void 0,void 0,function(){return p(this,function(t){switch(t.label){case 0:return[4,this._get("/api/v5/customdimensions")];case 1:return[2,t.sent().data.customDimensions]}})})},t.prototype.invokeTopXDataQuery=function(t){var e={queries:[{query:t,bucketIndex:0}]};return this._post("/api/v5/query/topXdata",e)},t.prototype.invokeSQLQuery=function(t){var e={query:t};return this._post("/api/v5/query/sql",e)},t.prototype._get=function(t){return this.backendSrv.datasourceRequest({method:"GET",url:this.baseUrl+t}).catch(function(t){return console.log(t),t.err?Promise.reject(t.err):Promise.reject(t)})},t.prototype._post=function(t,e){return this.backendSrv.datasourceRequest({method:"POST",url:this.baseUrl+t,data:e}).then(function(t){return t.data?t.data:[]}).catch(function(t){return console.log(t),t.err?Promise.reject(t.err):Promise.reject(t)})},t}();c.a.module("grafana.services").service("kentikAPISrv",_);var h=function(t,e,n,r){return new(n||(n=Promise))(function(i,o){function s(t){try{u(r.next(t))}catch(t){o(t)}}function a(t){try{u(r.throw(t))}catch(t){o(t)}}function u(t){t.done?i(t.value):new n(function(e){e(t.value)}).then(s,a)}u((r=r.apply(t,e||[])).next())})},m=function(t,e){var n,r,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,r=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(i=(i=s.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=e.call(t,s)}catch(t){o=[6,t],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}};function v(){var t=new Date;return t.getTime()+60*t.getTimezoneOffset()*1e3}function x(t){var e=a.a.cloneDeep(t);return e.starting_time=null,e.ending_time=null,JSON.stringify(e)}var g=function(){function t(t,e){this.kentikAPI=e,this.cache={},this.cacheUpdateInterval=3e5,this.requestCachingIntervals={"1d":0},this.getDevices=this.kentikAPI.getDevices.bind(this.kentikAPI)}return t.$inject=["backendSrv","kentikAPISrv"],t.prototype.invokeTopXDataQuery=function(t){var e=this,n=a.a.cloneDeep(t),r=x(n);return this.shouldInvoke(t)?this.kentikAPI.invokeTopXDataQuery(t).then(function(t){var i=v();return e.cache[r]={timestamp:i,query:n,result:t},console.log("Invoke Kentik query"),t}):(console.log("Get result from cache"),Promise.resolve(this.cache[r].result))},t.prototype.shouldInvoke=function(t){var e=t,n=x(e),r=v(),i=Date.parse(e.starting_time),o=Date.parse(e.ending_time),s=o-i,a=this.cache[n]?Date.parse(this.cache[n].query.starting_time):null,u=this.cache[n]?Date.parse(this.cache[n].query.ending_time):null,c=u-a,l=function(t){var e=Date.parse(t.ending_time)-Date.parse(t.starting_time);return e>f.a.duration(1,"months")?36e5:e>f.a.duration(1,"day")?9e5:3e5}(e);return!this.cache[n]||r-o>l||this.cache[n]&&(r-u>l||i<a||Math.abs(s-c)>6e4)},t.prototype.getFieldValues=function(t){var e=this,n=v();return this.cache[t]&&n-this.cache[t].ts<this.cacheUpdateInterval?Promise.resolve(this.cache[t].value):this.kentikAPI.getFieldValues(t).then(function(r){return n=v(),e.cache[t]={ts:n,value:r},r})},t.prototype.getCustomDimensions=function(){return h(this,void 0,void 0,function(){var t,e=this;return m(this,function(n){switch(n.label){case 0:return void 0!==this.cache.customDimensions?[3,2]:[4,this.kentikAPI.getCustomDimensions()];case 1:t=n.sent(),this.cache.customDimensions=t.map(function(t){return{values:e._getDimensionPopulatorsValues(t),text:"Custom "+t.display_name,value:t.name,field:t.name}}),n.label=2;case 2:return[2,this.cache.customDimensions]}})})},t.prototype._getDimensionPopulatorsValues=function(t){return t.populators.reduce(function(t,e){return t.push(e.value),t},[])},t}();c.a.module("grafana.services").service("kentikProxySrv",g);var b=n(9),y=n.n(b),P="YYYY-MM-DD HH:mm:ss";function S(t){return"unique_src_ip"===t.value||"unique_dst_ip"===t.value?function(t){return[{name:"avg_ips",column:t.field,fn:"average",raw:!0,sample_rate:1},{name:"p95th_ips",column:t.field,fn:"percentile",rank:95,sample_rate:1},{name:"max_ips",column:t.field,fn:"max",sample_rate:1,raw:!0},{name:"p95th_bits_per_sec",column:"f_sum_both_bytes",fn:"percentile",rank:95,sample_rate:1},{name:"p95th_pkts_per_sec",column:"f_sum_both_pkts",fn:"percentile",rank:95,sample_rate:1}]}(t):function(t){return[{name:"avg_both",column:t.field,fn:"average",raw:!0,sample_rate:1},{name:"p95th_both",column:t.field,fn:"percentile",rank:95,sample_rate:1},{name:"max_both",column:t.field,fn:"max",sample_rate:1}]}(t)}var D={buildTopXdataQuery:function(t){var e=a.a.find(i,{value:t.unit}),n=t.range.from.utc().format(P),r=t.range.to.utc().format(P);return{dimension:[t.metric],metric:t.unit,matrixBy:[],cidr:32,cidr6:128,topx:"8",depth:100,fastData:"Auto",lookback_seconds:0,time_format:"UTC",starting_time:n,ending_time:r,device_name:t.deviceNames,outsort:e.outsort,aggregates:S(e),filters_obj:function(t){var e={connector:"All",filterGroups:[]};return t.length&&(e.filterGroups=t),e}(t.kentikFilterGroups)}},formatAggs:S,convertToKentikFilterGroup:function(t,e){if(t.length){var n=a.a.map(t,function(t){return function(t,e){"!="===t.operator&&(t.operator="<>");var n=a.a.concat(o,e),r=a.a.find(n,{text:t.key});return{filterField:r?r.field:t.key,operator:t.operator,filterValue:t.value}}(t,e)}),r="All";return!t[0].condition||"or"!==t[0].condition.toLowerCase()&&"any"!==t[0].condition.toLowerCase()||(r="Any"),[{connector:r,filters:n,not:!1}]}return[]}},k=function(t,e,n,r){return new(n||(n=Promise))(function(i,o){function s(t){try{u(r.next(t))}catch(t){o(t)}}function a(t){try{u(r.throw(t))}catch(t){o(t)}}function u(t){t.done?i(t.value):new n(function(e){e(t.value)}).then(s,a)}u((r=r.apply(t,e||[])).next())})},A=function(t,e){var n,r,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,r=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(i=(i=s.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=e.call(t,s)}catch(t){o=[6,t],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}},w=function(){function t(t,e,n){this.instanceSettings=t,this.templateSrv=e,this.name=t.name,this.kentik=n}return t.$inject=["instanceSettings","templateSrv","kentikProxySrv"],t.prototype.interpolateDeviceField=function(t,e){return e.multi||e.includeAll?"string"==typeof t?t:t.join(","):t},t.prototype.query=function(t){return k(this,void 0,void 0,function(){var e,n,r,i,o,s;return A(this,function(a){switch(a.label){case 0:return t.targets&&0!==t.targets.length?(e=t.targets[0],n=this.templateSrv.replace(e.device,t.scopedVars,this.interpolateDeviceField.bind(this)),r=this.templateSrv.getAdhocFilters(this.name),[4,this.kentik.getCustomDimensions()]):[2,Promise.resolve({data:[]})];case 1:return i=a.sent(),r=D.convertToKentikFilterGroup(r,i),o={deviceNames:n,range:{from:t.range.from,to:t.range.to},metric:this.templateSrv.replace(e.metric),unit:this.templateSrv.replace(e.unit),kentikFilterGroups:r},s=D.buildTopXdataQuery(o),[2,this.kentik.invokeTopXDataQuery(s).then(this.processResponse.bind(this,s,e.mode,t)).then(function(t){return{data:t}})]}})})},t.prototype.processResponse=function(t,e,n,o){return k(this,void 0,void 0,function(){var s,u,c,l;return A(this,function(f){switch(f.label){case 0:return o.results?0===(s=o.results[0].data).length?[2,[]]:[4,this._getExtendedDimensionsList(r)]:[2,Promise.reject({message:"no kentik data"})];case 1:return u=f.sent(),c=a.a.find(u,{value:t.dimension[0]}),l=a.a.find(i,{value:t.metric}),"table"===e?[2,this.processTableData(s,c,l)]:[2,this.processTimeSeries(s,t,n)]}})})},t.prototype.processTimeSeries=function(t,e,n){var r=[],i=e.topx;t.length<i&&(i=t.length);for(var o=0;o<i;o++){var s=t[o],u=a.a.find(s.timeSeries,function(t){return t.flow&&t.flow.length}),c=s.key;if(u){var l={target:c,datapoints:a.a.map(u.flow,function(t){return[t[1],t[0]]})};r.push(l)}}return r},t.prototype.processTableData=function(t,e,n){var r=new y.a;r.columns.push({text:e.text});for(var i=0,o=n.tableFields;i<o.length;i++){var s=o[i];r.columns.push({text:s.text,unit:s.unit})}return a.a.forEach(t,function(t){for(var e=[t.key],i=0,o=n.tableFields;i<o.length;i++){var s=t[o[i].field];a.a.isString(s)&&(s=parseFloat(s)),e.push(s)}r.rows.push(e)}),[r]},t.prototype.metricFindQuery=function(t){return k(this,void 0,void 0,function(){return A(this,function(e){return"metrics()"===t?[2,this._getExtendedDimensionsList(r)]:"units()"===t?[2,i]:[2,this.kentik.getDevices().then(function(t){return t.map(function(t){return{text:t.device_name,value:t.device_name}})})]})})},t.prototype.getTagKeys=function(){return k(this,void 0,void 0,function(){return A(this,function(t){return[2,this._getExtendedDimensionsList(o)]})})},t.prototype.getTagValues=function(t){return k(this,void 0,void 0,function(){var e,n,r;return A(this,function(i){switch(i.label){case 0:return t?void 0!==(e=a.a.find(o,{text:t.key}))?[3,2]:[4,this.kentik.getCustomDimensions()]:[3,4];case 1:return n=i.sent(),[2,a.a.find(n,{text:t.key}).values.map(function(t){return{text:t}})];case 2:return r=e.field,[2,this.kentik.getFieldValues(r).then(function(t){return t.rows.map(function(t){return{text:t[r].toString()}})})];case 3:return[3,5];case 4:return[2,[]];case 5:return[2]}})})},t.prototype._getExtendedDimensionsList=function(t){return k(this,void 0,void 0,function(){var e;return A(this,function(n){switch(n.label){case 0:return[4,this.kentik.getCustomDimensions()];case 1:return e=n.sent(),[2,a.a.concat(t,e)]}})})},t}(),I=function(){function t(){}return t.templateUrl="datasource/config.html",t}(),N=n(1),C=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),T=function(t){function e(e,n){var r=t.call(this,e,n)||this;return r.target.mode=r.target.mode||"graph",r.queryModes=[{value:"graph",text:"Graph"},{value:"table",text:"Table"}],r}return C(e,t),e.$inject=["$scope","$injector"],e}(N.QueryCtrl);T.templateUrl="datasource/query_editor.html",n.d(e,"Datasource",function(){return w}),n.d(e,"ConfigCtrl",function(){return I}),n.d(e,"QueryCtrl",function(){return T})}])});
//# sourceMappingURL=module.js.map