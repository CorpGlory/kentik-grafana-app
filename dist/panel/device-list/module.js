define(["lodash","angular","app/core/core","app/plugins/sdk"],function(t,e,n,r){return function(t){var e={};function n(r){if(e[r])return e[r].exports;var i=e[r]={i:r,l:!1,exports:{}};return t[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)n.d(r,i,function(e){return t[e]}.bind(null,i));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=16)}([function(e,n){e.exports=t},function(t,e,n){"use strict";function r(t){var e="default";for(var n in t)if("kentik-ds"===t[n].type)return"custom"===(e=t[n].jsonData.region)&&console.log("getRegion(): Custom Dynamic URL: "+t[n].jsonData.dynamicUrl),e;return e}n.d(e,"a",function(){return r})},function(t,e,n){"use strict";n.d(e,"a",function(){return o}),n.d(e,"b",function(){return a});var r=n(5),i=n(0);function o(t){var e="";e+=t.status?"("+t.status+") ":"",e+=t.statusText?t.statusText+": ":"",t.data&&t.data.error?e+=t.data.error:t.err?e+=t.err:i.isString(t)&&(e+=t),r.appEvents.emit("alert-error",["Can't connect to Kentik API",e])}function a(t,e,n){var o="";o+=e.status?"("+e.status+") ":"",o+=e.statusText?e.statusText+": ":"",e.data&&e.data.error?o+=e.data.error:e.err?o+=e.err:i.isString(e)&&(o+=e),r.appEvents.emit("alert-"+n,[t,o])}},function(t,n){t.exports=e},function(t,e,n){"use strict";n.d(e,"a",function(){return s});var r=n(3),i=n.n(r),o=n(1),a=function(t,e,n,r){return new(n||(n=Promise))(function(i,o){function a(t){try{s(r.next(t))}catch(t){o(t)}}function u(t){try{s(r.throw(t))}catch(t){o(t)}}function s(t){t.done?i(t.value):new n(function(e){e(t.value)}).then(a,u)}s((r=r.apply(t,e||[])).next())})},u=function(t,e){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function u(o){return function(u){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=e.call(t,a)}catch(t){o=[6,t],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,u])}}},s=function(){function t(t){var e=this;this.backendSrv=t,this.apiReady=!1,this.baseUrl="/api/plugin-proxy/kentik-app",t.get("/api/datasources").then(function(t){e.region=Object(o.a)(t),e.setRegion(e.region),e.apiReady=!0})}return t.$inject=["backendSrv"],t.prototype.setRegion=function(t){this.region=t},t.prototype.getDevices=function(){return a(this,void 0,void 0,function(){var t,e=this;return u(this,function(n){switch(n.label){case 0:return this.backendSrv.get("/api/datasources").then(function(t){e.region=Object(o.a)(t),e.setRegion(e.region),e.apiReady=!0}),[4,this._get("/api/v5/devices")];case 1:return(t=n.sent()).data&&t.data.devices?[2,t.data.devices]:[2,[]]}})})},t.prototype.getUsers=function(){return a(this,void 0,void 0,function(){return u(this,function(t){switch(t.label){case 0:return[4,this._get("/api/v5/users")];case 1:return[2,t.sent()]}})})},t.prototype.getFieldValues=function(t){var e="SELECT DISTINCT "+t+" FROM all_devices ORDER BY "+t+" ASC";return this.invokeSQLQuery(e)},t.prototype.getCustomDimensions=function(){return a(this,void 0,void 0,function(){return u(this,function(t){switch(t.label){case 0:return[4,this._get("/api/v5/customdimensions")];case 1:return[2,t.sent().data.customDimensions]}})})},t.prototype.getSavedFilters=function(){return a(this,void 0,void 0,function(){return u(this,function(t){switch(t.label){case 0:return[4,this._get("/api/v5/saved-filters")];case 1:return[2,t.sent().data]}})})},t.prototype.invokeTopXDataQuery=function(t){var e={queries:[{query:t,bucketIndex:0}]};return this._post("/api/v5/query/topXdata",e)},t.prototype.invokeSQLQuery=function(t){var e={query:t};return this._post("/api/v5/query/sql",e)},t.prototype._get=function(t){return a(this,void 0,void 0,function(){var e=this;return u(this,function(n){switch(n.label){case 0:return void 0!==this.region?[3,2]:[4,this.backendSrv.get("/api/datasources").then(function(t){e.setRegion(Object(o.a)(t))})];case 1:n.sent(),n.label=2;case 2:return[2,this.backendSrv.datasourceRequest({method:"GET",url:this.baseUrl+"/"+this.region+t}).catch(function(t){return console.error(t),t.err?Promise.reject(t.err):Promise.reject(t)})]}})})},t.prototype._post=function(t,e){return a(this,void 0,void 0,function(){var n=this;return u(this,function(r){switch(r.label){case 0:return void 0!==this.region?[3,2]:[4,this.backendSrv.get("/api/datasources").then(function(t){n.setRegion(Object(o.a)(t))})];case 1:r.sent(),r.label=2;case 2:return[2,this.backendSrv.datasourceRequest({method:"POST",url:this.baseUrl+"/"+this.region+t,data:e}).then(function(t){return t.data?t.data:[]}).catch(function(t){return console.error(t),t.err?Promise.reject(t.err):Promise.reject(t)})]}})})},t}();i.a.module("grafana.services").service("kentikAPISrv",s)},function(t,e){t.exports=n},function(t,e){t.exports=r},,,,,,,,,,function(t,e,n){"use strict";n.r(e),n.d(e,"PanelCtrl",function(){return d});var r,i=n(4),o=n(2),a=n(6),u=n(1),s=n(0),c=(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),l=function(t,e,n,r){return new(n||(n=Promise))(function(i,o){function a(t){try{s(r.next(t))}catch(t){o(t)}}function u(t){try{s(r.throw(t))}catch(t){o(t)}}function s(t){t.done?i(t.value):new n(function(e){e(t.value)}).then(a,u)}s((r=r.apply(t,e||[])).next())})},f=function(t,e){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function u(o){return function(u){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=e.call(t,a)}catch(t){o=[6,t],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,u])}}};Object(a.loadPluginCss)({dark:"plugins/kentik-app/css/kentik.dark.css",light:"plugins/kentik-app/css/kentik.light.css"});var p={fullscreen:!0},d=function(t){function e(e,n,r,o){var a=t.call(this,e,n)||this;return a.$location=r,a.backendSrv=o,s.defaults(a.panel,p),a.devices=[],a.pageReady=!1,o.get("/api/datasources").then(function(t){a.region=Object(u.a)(t),a.kentik=new i.a(a.backendSrv),a.kentik.setRegion(a.region)}).then(function(){return l(a,void 0,void 0,function(){return f(this,function(t){switch(t.label){case 0:return[4,this.getDevices()];case 1:return t.sent(),[2]}})})}),a}return c(e,t),e.$inject=["$scope","$injector","$location","backendSrv"],e.prototype.getDevices=function(){return l(this,void 0,void 0,function(){var t,e;return f(this,function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),t=this,[4,this.kentik.getDevices()];case 1:return t.devices=n.sent(),this.pageReady=!0,[3,3];case 2:return e=n.sent(),Object(o.a)(e),[3,3];case 3:return[2]}})})},e.prototype.refresh=function(){this.getDevices()},e.prototype.gotoDashboard=function(t){this.$location.path("/dashboard/db/kentik-top-talkers").search({"var-device":t.device_name})},e.prototype.gotoDeviceDetail=function(t){this.$location.url("/plugins/kentik-app/page/device-details?device="+t.id)},e}(a.PanelCtrl);d.templateUrl="public/plugins/kentik-app/components/device_list.html"}])});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vd2VicGFjay9ib290c3RyYXAiLCJ3ZWJwYWNrOi8vL2V4dGVybmFsIFwibG9kYXNoXCIiLCJ3ZWJwYWNrOi8vLy4vZGF0YXNvdXJjZS9yZWdpb25IZWxwZXIudHMiLCJ3ZWJwYWNrOi8vLy4vZGF0YXNvdXJjZS9hbGVydEhlbHBlci50cyIsIndlYnBhY2s6Ly8vZXh0ZXJuYWwgXCJhbmd1bGFyXCIiLCJ3ZWJwYWNrOi8vLy4vZGF0YXNvdXJjZS9rZW50aWtBUEkudHMiLCJ3ZWJwYWNrOi8vLy4vcGFuZWwvZGV2aWNlLWxpc3QvbW9kdWxlLnRzIl0sIm5hbWVzIjpbImluc3RhbGxlZE1vZHVsZXMiLCJfX3dlYnBhY2tfcmVxdWlyZV9fIiwibW9kdWxlSWQiLCJleHBvcnRzIiwibW9kdWxlIiwiaSIsImwiLCJtb2R1bGVzIiwiY2FsbCIsIm0iLCJjIiwiZCIsIm5hbWUiLCJnZXR0ZXIiLCJvIiwiT2JqZWN0IiwiZGVmaW5lUHJvcGVydHkiLCJlbnVtZXJhYmxlIiwiZ2V0IiwiciIsIlN5bWJvbCIsInRvU3RyaW5nVGFnIiwidmFsdWUiLCJ0IiwibW9kZSIsIl9fZXNNb2R1bGUiLCJucyIsImNyZWF0ZSIsImtleSIsImJpbmQiLCJuIiwib2JqZWN0IiwicHJvcGVydHkiLCJwcm90b3R5cGUiLCJoYXNPd25Qcm9wZXJ0eSIsInAiLCJzIiwiX19XRUJQQUNLX0VYVEVSTkFMX01PRFVMRV9fMF9fIiwiZ2V0UmVnaW9uIiwiZGF0YXNvdXJjZXMiLCJhUmVnaW9uIiwiaW5kZXgiLCJ0eXBlIiwianNvbkRhdGEiLCJyZWdpb24iLCJjb25zb2xlIiwibG9nIiwiZHluYW1pY1VybCIsIl9fd2VicGFja19leHBvcnRzX18iLCJzaG93QWxlcnQiLCJzaG93Q3VzdG9tQWxlcnQiLCJncmFmYW5hX2FwcF9jb3JlX2NvcmVfX1dFQlBBQ0tfSU1QT1JURURfTU9EVUxFXzBfXyIsImxvZGFzaF9fV0VCUEFDS19JTVBPUlRFRF9NT0RVTEVfMV9fIiwiZXJyb3IiLCJtZXNzYWdlIiwic3RhdHVzIiwic3RhdHVzVGV4dCIsImRhdGEiLCJlcnIiLCJlbWl0IiwiZXhjZXB0aW9uRGF0YSIsImV4Y2VwdGlvblR5cGUiLCJlcnJNZXNzYWdlIiwiX19XRUJQQUNLX0VYVEVSTkFMX01PRFVMRV9fM19fIiwiS2VudGlrQVBJIiwiYmFja2VuZFNydiIsIl90aGlzIiwidGhpcyIsImFwaVJlYWR5IiwiYmFzZVVybCIsInRoZW4iLCJhbGxEUyIsIl9yZWdpb25IZWxwZXJfX1dFQlBBQ0tfSU1QT1JURURfTU9EVUxFXzFfXyIsInNldFJlZ2lvbiIsIiRpbmplY3QiLCJyZXNwIiwiX2EiLCJzZW50IiwiZGV2aWNlcyIsImdldEZpZWxkVmFsdWVzIiwiZmllbGQiLCJxdWVyeSIsImludm9rZVNRTFF1ZXJ5IiwiaW52b2tlVG9wWERhdGFRdWVyeSIsImtlbnRpa1Y1UXVlcnkiLCJxdWVyaWVzIiwiYnVja2V0SW5kZXgiLCJfcG9zdCIsImRhdGFzb3VyY2VSZXF1ZXN0IiwibWV0aG9kIiwidXJsIiwiY2F0Y2giLCJQcm9taXNlIiwicmVqZWN0IiwicmVzcG9uc2UiLCJncmFmYW5hX2FwcF9wbHVnaW5zX3Nka19fV0VCUEFDS19JTVBPUlRFRF9NT0RVTEVfMl9fIiwiZGFyayIsImxpZ2h0IiwicGFuZWxEZWZhdWx0cyIsImZ1bGxzY3JlZW4iLCJEZXZpY2VMaXN0Q3RybCIsIl9zdXBlciIsIiRzY29wZSIsIiRpbmplY3RvciIsIiRsb2NhdGlvbiIsImxvZGFzaF9fV0VCUEFDS19JTVBPUlRFRF9NT0RVTEVfNF9fIiwicGFuZWwiLCJwYWdlUmVhZHkiLCJfZGF0YXNvdXJjZV9yZWdpb25IZWxwZXJfX1dFQlBBQ0tfSU1QT1JURURfTU9EVUxFXzNfXyIsImtlbnRpayIsIl9kYXRhc291cmNlX2tlbnRpa0FQSV9fV0VCUEFDS19JTVBPUlRFRF9NT0RVTEVfMF9fIiwiZ2V0RGV2aWNlcyIsIl9fZXh0ZW5kcyIsIl9iIiwidHJ5cyIsInB1c2giLCJyZWZyZXNoIiwiZ290b0Rhc2hib2FyZCIsImRldmljZSIsInBhdGgiLCJzZWFyY2giLCJ2YXItZGV2aWNlIiwiZGV2aWNlX25hbWUiLCJnb3RvRGV2aWNlRGV0YWlsIiwiaWQiXSwibWFwcGluZ3MiOiJtR0FDQSxJQUFBQSxFQUFBLEdBR0EsU0FBQUMsRUFBQUMsR0FHQSxHQUFBRixFQUFBRSxHQUNBLE9BQUFGLEVBQUFFLEdBQUFDLFFBR0EsSUFBQUMsRUFBQUosRUFBQUUsR0FBQSxDQUNBRyxFQUFBSCxFQUNBSSxHQUFBLEVBQ0FILFFBQUEsSUFVQSxPQU5BSSxFQUFBTCxHQUFBTSxLQUFBSixFQUFBRCxRQUFBQyxJQUFBRCxRQUFBRixHQUdBRyxFQUFBRSxHQUFBLEVBR0FGLEVBQUFELFFBMERBLE9BckRBRixFQUFBUSxFQUFBRixFQUdBTixFQUFBUyxFQUFBVixFQUdBQyxFQUFBVSxFQUFBLFNBQUFSLEVBQUFTLEVBQUFDLEdBQ0FaLEVBQUFhLEVBQUFYLEVBQUFTLElBQ0FHLE9BQUFDLGVBQUFiLEVBQUFTLEVBQUEsQ0FBMENLLFlBQUEsRUFBQUMsSUFBQUwsS0FLMUNaLEVBQUFrQixFQUFBLFNBQUFoQixHQUNBLG9CQUFBaUIsZUFBQUMsYUFDQU4sT0FBQUMsZUFBQWIsRUFBQWlCLE9BQUFDLFlBQUEsQ0FBd0RDLE1BQUEsV0FFeERQLE9BQUFDLGVBQUFiLEVBQUEsY0FBaURtQixPQUFBLEtBUWpEckIsRUFBQXNCLEVBQUEsU0FBQUQsRUFBQUUsR0FFQSxHQURBLEVBQUFBLElBQUFGLEVBQUFyQixFQUFBcUIsSUFDQSxFQUFBRSxFQUFBLE9BQUFGLEVBQ0EsS0FBQUUsR0FBQSxpQkFBQUYsUUFBQUcsV0FBQSxPQUFBSCxFQUNBLElBQUFJLEVBQUFYLE9BQUFZLE9BQUEsTUFHQSxHQUZBMUIsRUFBQWtCLEVBQUFPLEdBQ0FYLE9BQUFDLGVBQUFVLEVBQUEsV0FBeUNULFlBQUEsRUFBQUssVUFDekMsRUFBQUUsR0FBQSxpQkFBQUYsRUFBQSxRQUFBTSxLQUFBTixFQUFBckIsRUFBQVUsRUFBQWUsRUFBQUUsRUFBQSxTQUFBQSxHQUFnSCxP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ZXZpY2UtbGlzdC9tb2R1bGUuanMiLCJzb3VyY2VzQ29udGVudCI6WyIgXHQvLyBUaGUgbW9kdWxlIGNhY2hlXG4gXHR2YXIgaW5zdGFsbGVkTW9kdWxlcyA9IHt9O1xuXG4gXHQvLyBUaGUgcmVxdWlyZSBmdW5jdGlvblxuIFx0ZnVuY3Rpb24gX193ZWJwYWNrX3JlcXVpcmVfXyhtb2R1bGVJZCkge1xuXG4gXHRcdC8vIENoZWNrIGlmIG1vZHVsZSBpcyBpbiBjYWNoZVxuIFx0XHRpZihpbnN0YWxsZWRNb2R1bGVzW21vZHVsZUlkXSkge1xuIFx0XHRcdHJldHVybiBpbnN0YWxsZWRNb2R1bGVzW21vZHVsZUlkXS5leHBvcnRzO1xuIFx0XHR9XG4gXHRcdC8vIENyZWF0ZSBhIG5ldyBtb2R1bGUgKGFuZCBwdXQgaXQgaW50byB0aGUgY2FjaGUpXG4gXHRcdHZhciBtb2R1bGUgPSBpbnN0YWxsZWRNb2R1bGVzW21vZHVsZUlkXSA9IHtcbiBcdFx0XHRpOiBtb2R1bGVJZCxcbiBcdFx0XHRsOiBmYWxzZSxcbiBcdFx0XHRleHBvcnRzOiB7fVxuIFx0XHR9O1xuXG4gXHRcdC8vIEV4ZWN1dGUgdGhlIG1vZHVsZSBmdW5jdGlvblxuIFx0XHRtb2R1bGVzW21vZHVsZUlkXS5jYWxsKG1vZHVsZS5leHBvcnRzLCBtb2R1bGUsIG1vZHVsZS5leHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKTtcblxuIFx0XHQvLyBGbGFnIHRoZSBtb2R1bGUgYXMgbG9hZGVkXG4gXHRcdG1vZHVsZS5sID0gdHJ1ZTtcblxuIFx0XHQvLyBSZXR1cm4gdGhlIGV4cG9ydHMgb2YgdGhlIG1vZHVsZVxuIFx0XHRyZXR1cm4gbW9kdWxlLmV4cG9ydHM7XG4gXHR9XG5cblxuIFx0Ly8gZXhwb3NlIHRoZSBtb2R1bGVzIG9iamVjdCAoX193ZWJwYWNrX21vZHVsZXNfXylcbiBcdF9fd2VicGFja19yZXF1aXJlX18ubSA9IG1vZHVsZXM7XG5cbiBcdC8vIGV4cG9zZSB0aGUgbW9kdWxlIGNhY2hlXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLmMgPSBpbnN0YWxsZWRNb2R1bGVzO1xuXG4gXHQvLyBkZWZpbmUgZ2V0dGVyIGZ1bmN0aW9uIGZvciBoYXJtb255IGV4cG9ydHNcbiBcdF9fd2VicGFja19yZXF1aXJlX18uZCA9IGZ1bmN0aW9uKGV4cG9ydHMsIG5hbWUsIGdldHRlcikge1xuIFx0XHRpZighX193ZWJwYWNrX3JlcXVpcmVfXy5vKGV4cG9ydHMsIG5hbWUpKSB7XG4gXHRcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIG5hbWUsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBnZXR0ZXIgfSk7XG4gXHRcdH1cbiBcdH07XG5cbiBcdC8vIGRlZmluZSBfX2VzTW9kdWxlIG9uIGV4cG9ydHNcbiBcdF9fd2VicGFja19yZXF1aXJlX18uciA9IGZ1bmN0aW9uKGV4cG9ydHMpIHtcbiBcdFx0aWYodHlwZW9mIFN5bWJvbCAhPT0gJ3VuZGVmaW5lZCcgJiYgU3ltYm9sLnRvU3RyaW5nVGFnKSB7XG4gXHRcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFN5bWJvbC50b1N0cmluZ1RhZywgeyB2YWx1ZTogJ01vZHVsZScgfSk7XG4gXHRcdH1cbiBcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICdfX2VzTW9kdWxlJywgeyB2YWx1ZTogdHJ1ZSB9KTtcbiBcdH07XG5cbiBcdC8vIGNyZWF0ZSBhIGZha2UgbmFtZXNwYWNlIG9iamVjdFxuIFx0Ly8gbW9kZSAmIDE6IHZhbHVlIGlzIGEgbW9kdWxlIGlkLCByZXF1aXJlIGl0XG4gXHQvLyBtb2RlICYgMjogbWVyZ2UgYWxsIHByb3BlcnRpZXMgb2YgdmFsdWUgaW50byB0aGUgbnNcbiBcdC8vIG1vZGUgJiA0OiByZXR1cm4gdmFsdWUgd2hlbiBhbHJlYWR5IG5zIG9iamVjdFxuIFx0Ly8gbW9kZSAmIDh8MTogYmVoYXZlIGxpa2UgcmVxdWlyZVxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy50ID0gZnVuY3Rpb24odmFsdWUsIG1vZGUpIHtcbiBcdFx0aWYobW9kZSAmIDEpIHZhbHVlID0gX193ZWJwYWNrX3JlcXVpcmVfXyh2YWx1ZSk7XG4gXHRcdGlmKG1vZGUgJiA4KSByZXR1cm4gdmFsdWU7XG4gXHRcdGlmKChtb2RlICYgNCkgJiYgdHlwZW9mIHZhbHVlID09PSAnb2JqZWN0JyAmJiB2YWx1ZSAmJiB2YWx1ZS5fX2VzTW9kdWxlKSByZXR1cm4gdmFsdWU7XG4gXHRcdHZhciBucyA9IE9iamVjdC5jcmVhdGUobnVsbCk7XG4gXHRcdF9fd2VicGFja19yZXF1aXJlX18ucihucyk7XG4gXHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShucywgJ2RlZmF1bHQnLCB7IGVudW1lcmFibGU6IHRydWUsIHZhbHVlOiB2YWx1ZSB9KTtcbiBcdFx0aWYobW9kZSAmIDIgJiYgdHlwZW9mIHZhbHVlICE9ICdzdHJpbmcnKSBmb3IodmFyIGtleSBpbiB2YWx1ZSkgX193ZWJwYWNrX3JlcXVpcmVfXy5kKG5zLCBrZXksIGZ1bmN0aW9uKGtleSkgeyByZXR1cm4gdmFsdWVba2V5XTsgfS5iaW5kKG51bGwsIGtleSkpO1xuIFx0XHRyZXR1cm4gbnM7XG4gXHR9O1xuXG4gXHQvLyBnZXREZWZhdWx0RXhwb3J0IGZ1bmN0aW9uIGZvciBjb21wYXRpYmlsaXR5IHdpdGggbm9uLWhhcm1vbnkgbW9kdWxlc1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5uID0gZnVuY3Rpb24obW9kdWxlKSB7XG4gXHRcdHZhciBnZXR0ZXIgPSBtb2R1bGUgJiYgbW9kdWxlLl9fZXNNb2R1bGUgP1xuIFx0XHRcdGZ1bmN0aW9uIGdldERlZmF1bHQoKSB7IHJldHVybiBtb2R1bGVbJ2RlZmF1bHQnXTsgfSA6XG4gXHRcdFx0ZnVuY3Rpb24gZ2V0TW9kdWxlRXhwb3J0cygpIHsgcmV0dXJuIG1vZHVsZTsgfTtcbiBcdFx0X193ZWJwYWNrX3JlcXVpcmVfXy5kKGdldHRlciwgJ2EnLCBnZXR0ZXIpO1xuIFx0XHRyZXR1cm4gZ2V0dGVyO1xuIFx0fTtcblxuIFx0Ly8gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLm8gPSBmdW5jdGlvbihvYmplY3QsIHByb3BlcnR5KSB7IHJldHVybiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwob2JqZWN0LCBwcm9wZXJ0eSk7IH07XG5cbiBcdC8vIF9fd2VicGFja19wdWJsaWNfcGF0aF9fXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLnAgPSBcIlwiO1xuXG5cbiBcdC8vIExvYWQgZW50cnkgbW9kdWxlIGFuZCByZXR1cm4gZXhwb3J0c1xuIFx0cmV0dXJuIF9fd2VicGFja19yZXF1aXJlX18oX193ZWJwYWNrX3JlcXVpcmVfXy5zID0gMTYpO1xuIiwibW9kdWxlLmV4cG9ydHMgPSBfX1dFQlBBQ0tfRVhURVJOQUxfTU9EVUxFX18wX187IiwiIC8qKlxuICAqIFJldHVybnMgdGhlIHJlZ2lvbiBhc3NvY2lhdGVkIHdpdGggdGhlIGtlbnRpay1rc1xuXG4gICogQHBhcmFtIGRhdGFzb3VyY2VzIFxuICAqL1xuZnVuY3Rpb24gZ2V0UmVnaW9uKGRhdGFzb3VyY2VzOiBhbnkpOiBzdHJpbmcge1xuICBsZXQgYVJlZ2lvbiA9IFwiZGVmYXVsdFwiO1xuICBmb3IgKHZhciBpbmRleCBpbiBkYXRhc291cmNlcykge1xuICAgIGlmIChkYXRhc291cmNlc1tpbmRleF0udHlwZSA9PT0gXCJrZW50aWstZHNcIikge1xuICAgICAgYVJlZ2lvbiA9IGRhdGFzb3VyY2VzW2luZGV4XS5qc29uRGF0YS5yZWdpb247XG4gICAgICBpZiAoYVJlZ2lvbiA9PT0gJ2N1c3RvbScpIHtcbiAgICAgICAgY29uc29sZS5sb2coXCJnZXRSZWdpb24oKTogQ3VzdG9tIER5bmFtaWMgVVJMOiBcIiArIGRhdGFzb3VyY2VzW2luZGV4XS5qc29uRGF0YS5keW5hbWljVXJsKTtcbiAgICAgICAgLy9jb25zb2xlLmxvZyhcImdldFJlZ2lvbigpOiBDdXN0b20gRFMgSW5mbzogXCIgKyBKU09OLnN0cmluZ2lmeShkYXRhc291cmNlc1tpbmRleF0pKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBhUmVnaW9uO1xuICAgIH1cbiAgfVxuICByZXR1cm4gYVJlZ2lvbjtcbn1cblxuZXhwb3J0IHsgZ2V0UmVnaW9uIH1cbiIsImltcG9ydCB7IGFwcEV2ZW50cyB9IGZyb20gJ2dyYWZhbmEvYXBwL2NvcmUvY29yZSc7XG5pbXBvcnQgKiBhcyBfIGZyb20gJ2xvZGFzaCc7XG5cbmZ1bmN0aW9uIHNob3dBbGVydChlcnJvcikge1xuICBsZXQgbWVzc2FnZSA9ICcnO1xuICBtZXNzYWdlICs9IGVycm9yLnN0YXR1cyA/IGAoJHtlcnJvci5zdGF0dXN9KSBgIDogJyc7XG4gIG1lc3NhZ2UgKz0gZXJyb3Iuc3RhdHVzVGV4dCA/IGVycm9yLnN0YXR1c1RleHQgKyAnOiAnIDogJyc7XG4gIGlmIChlcnJvci5kYXRhICYmIGVycm9yLmRhdGEuZXJyb3IpIHtcbiAgICBtZXNzYWdlICs9IGVycm9yLmRhdGEuZXJyb3I7XG4gIH0gZWxzZSBpZiAoZXJyb3IuZXJyKSB7XG4gICAgbWVzc2FnZSArPSBlcnJvci5lcnI7XG4gIH0gZWxzZSBpZiAoXy5pc1N0cmluZyhlcnJvcikpIHtcbiAgICBtZXNzYWdlICs9IGVycm9yO1xuICB9XG5cbiAgYXBwRXZlbnRzLmVtaXQoJ2FsZXJ0LWVycm9yJywgW1wiQ2FuJ3QgY29ubmVjdCB0byBLZW50aWsgQVBJXCIsIG1lc3NhZ2VdKTtcbn1cblxuZnVuY3Rpb24gc2hvd0N1c3RvbUFsZXJ0KG1lc3NhZ2UsIGV4Y2VwdGlvbkRhdGEsIGV4Y2VwdGlvblR5cGUpIHtcbiAgbGV0IGVyck1lc3NhZ2UgPSAnJztcbiAgZXJyTWVzc2FnZSArPSBleGNlcHRpb25EYXRhLnN0YXR1cyA/IGAoJHtleGNlcHRpb25EYXRhLnN0YXR1c30pIGAgOiAnJztcbiAgZXJyTWVzc2FnZSArPSBleGNlcHRpb25EYXRhLnN0YXR1c1RleHQgPyBleGNlcHRpb25EYXRhLnN0YXR1c1RleHQgKyAnOiAnIDogJyc7XG4gIGlmIChleGNlcHRpb25EYXRhLmRhdGEgJiYgZXhjZXB0aW9uRGF0YS5kYXRhLmVycm9yKSB7XG4gICAgZXJyTWVzc2FnZSArPSBleGNlcHRpb25EYXRhLmRhdGEuZXJyb3I7XG4gIH0gZWxzZSBpZiAoZXhjZXB0aW9uRGF0YS5lcnIpIHtcbiAgICBlcnJNZXNzYWdlICs9IGV4Y2VwdGlvbkRhdGEuZXJyO1xuICB9IGVsc2UgaWYgKF8uaXNTdHJpbmcoZXhjZXB0aW9uRGF0YSkpIHtcbiAgICBlcnJNZXNzYWdlICs9IGV4Y2VwdGlvbkRhdGE7XG4gIH1cbiAgYXBwRXZlbnRzLmVtaXQoYGFsZXJ0LSR7ZXhjZXB0aW9uVHlwZX1gLCBbbWVzc2FnZSwgZXJyTWVzc2FnZV0pO1xufVxuXG5leHBvcnQgeyBzaG93QWxlcnQsIHNob3dDdXN0b21BbGVydCB9O1xuIiwibW9kdWxlLmV4cG9ydHMgPSBfX1dFQlBBQ0tfRVhURVJOQUxfTU9EVUxFX18zX187IiwiaW1wb3J0ICogYXMgXyBmcm9tICdsb2Rhc2gnO1xuaW1wb3J0IGFuZ3VsYXIgZnJvbSAnYW5ndWxhcic7XG5pbXBvcnQgeyBnZXRSZWdpb24gfSBmcm9tIFwiLi9yZWdpb25IZWxwZXJcIjtcblxuZXhwb3J0IGNsYXNzIEtlbnRpa0FQSSB7XG4gIGJhc2VVcmw6IHN0cmluZztcbiAgcmVnaW9uOiBzdHJpbmc7XG4gIGFwaVJlYWR5OiBib29sZWFuO1xuICAvKiogQG5nSW5qZWN0ICovXG4gIGNvbnN0cnVjdG9yKHB1YmxpYyBiYWNrZW5kU3J2OiBhbnkpIHtcbiAgICB0aGlzLmFwaVJlYWR5ID0gZmFsc2U7XG4gICAgdGhpcy5iYXNlVXJsID0gXCIvYXBpL3BsdWdpbi1wcm94eS9rZW50aWstYXBwXCI7XG4gICAgLy8gZ2V0IHJlZ2lvbiBmcm9tIGRhdGFzb3VyY2VcbiAgICBiYWNrZW5kU3J2LmdldCgnL2FwaS9kYXRhc291cmNlcycpLnRoZW4oIChhbGxEUzogYW55KSA9PiB7XG4gICAgICB0aGlzLnJlZ2lvbiA9IGdldFJlZ2lvbihhbGxEUyk7XG4gICAgICB0aGlzLnNldFJlZ2lvbih0aGlzLnJlZ2lvbik7XG4gICAgICB0aGlzLmFwaVJlYWR5ID0gdHJ1ZTtcbiAgICB9KTtcbiAgfVxuXG4gIHNldFJlZ2lvbihyZWdpb246IHN0cmluZykge1xuICAgIHRoaXMucmVnaW9uID0gcmVnaW9uO1xuICB9XG5cbiAgYXN5bmMgZ2V0RGV2aWNlcygpIHtcbiAgICB0aGlzLmJhY2tlbmRTcnYuZ2V0KCcvYXBpL2RhdGFzb3VyY2VzJykudGhlbiggKGFsbERTOiBhbnkpID0+IHtcbiAgICAgIHRoaXMucmVnaW9uID0gZ2V0UmVnaW9uKGFsbERTKTtcbiAgICAgIHRoaXMuc2V0UmVnaW9uKHRoaXMucmVnaW9uKTtcbiAgICAgIHRoaXMuYXBpUmVhZHkgPSB0cnVlO1xuICAgIH0pO1xuXG4gICAgY29uc3QgcmVzcCA9IGF3YWl0IHRoaXMuX2dldCgnL2FwaS92NS9kZXZpY2VzJyk7XG5cbiAgICBpZiAocmVzcC5kYXRhICYmIHJlc3AuZGF0YS5kZXZpY2VzKSB7XG4gICAgICByZXR1cm4gcmVzcC5kYXRhLmRldmljZXM7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiBbXTtcbiAgICB9XG4gIH1cblxuICBhc3luYyBnZXRVc2VycygpIHtcbiAgICBjb25zdCBkYXRhID0gYXdhaXQgdGhpcy5fZ2V0KCcvYXBpL3Y1L3VzZXJzJylcbiAgICByZXR1cm4gZGF0YTtcbiAgfVxuXG4gIGdldEZpZWxkVmFsdWVzKGZpZWxkOiBzdHJpbmcpIHtcbiAgICBjb25zdCBxdWVyeSA9IGBTRUxFQ1QgRElTVElOQ1QgJHtmaWVsZH0gRlJPTSBhbGxfZGV2aWNlcyBPUkRFUiBCWSAke2ZpZWxkfSBBU0NgO1xuICAgIHJldHVybiB0aGlzLmludm9rZVNRTFF1ZXJ5KHF1ZXJ5KTtcbiAgfVxuXG4gIGFzeW5jIGdldEN1c3RvbURpbWVuc2lvbnMoKSB7XG4gICAgY29uc3QgZGF0YSA9IGF3YWl0IHRoaXMuX2dldCgnL2FwaS92NS9jdXN0b21kaW1lbnNpb25zJyk7XG4gICAgcmV0dXJuIGRhdGEuZGF0YS5jdXN0b21EaW1lbnNpb25zO1xuICB9XG5cbiAgYXN5bmMgZ2V0U2F2ZWRGaWx0ZXJzKCkge1xuICAgIGNvbnN0IGRhdGEgPSBhd2FpdCB0aGlzLl9nZXQoJy9hcGkvdjUvc2F2ZWQtZmlsdGVycycpO1xuICAgIHJldHVybiBkYXRhLmRhdGE7XG4gIH1cblxuICBpbnZva2VUb3BYRGF0YVF1ZXJ5KHF1ZXJ5OiBhbnkpIHtcbiAgICBjb25zdCBrZW50aWtWNVF1ZXJ5ID0ge1xuICAgICAgcXVlcmllczogW3sgcXVlcnk6IHF1ZXJ5LCBidWNrZXRJbmRleDogMCB9XSxcbiAgICB9O1xuXG4gICAgcmV0dXJuIHRoaXMuX3Bvc3QoJy9hcGkvdjUvcXVlcnkvdG9wWGRhdGEnLCBrZW50aWtWNVF1ZXJ5KTtcbiAgfVxuXG4gIGludm9rZVNRTFF1ZXJ5KHF1ZXJ5OiBhbnkpIHtcbiAgICBjb25zdCBkYXRhID0ge1xuICAgICAgcXVlcnk6IHF1ZXJ5LFxuICAgIH07XG5cbiAgICByZXR1cm4gdGhpcy5fcG9zdCgnL2FwaS92NS9xdWVyeS9zcWwnLCBkYXRhKTtcbiAgfVxuXG4gIGFzeW5jIF9nZXQodXJsOiBzdHJpbmcpIHtcbiAgICAvLyBpZiB0aGUgcmVnaW9uIGlzIG5vdCBzZXQsIGdldCBpdCBmcm9tIHRoZSBkYXRhc291cmNlXG4gICAgaWYgKHR5cGVvZiB0aGlzLnJlZ2lvbiA9PT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgIC8vY29uc29sZS5sb2coXCJfZ2V0OiB0aGlzLnJlZ2lvbiBVTkRFRklORUQsIGZldGNoaW5nXCIpO1xuICAgICAgYXdhaXQgdGhpcy5iYWNrZW5kU3J2LmdldCgnL2FwaS9kYXRhc291cmNlcycpLnRoZW4oIChhbGxEUzogYW55KSA9PiB7XG4gICAgICAgIHRoaXMuc2V0UmVnaW9uKGdldFJlZ2lvbihhbGxEUykpO1xuICAgICAgICAvL2NvbnNvbGUubG9nKFwia2VudGlrQVBJOiBfZ2V0OiBGRVRDSEVEIHJlZ2lvbiBcIiArIHRoaXMucmVnaW9uKTtcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIHJldHVybiB0aGlzLmJhY2tlbmRTcnZcbiAgICAgIC5kYXRhc291cmNlUmVxdWVzdCh7XG4gICAgICAgIG1ldGhvZDogJ0dFVCcsXG4gICAgICAgIHVybDogdGhpcy5iYXNlVXJsICsgXCIvXCIgKyB0aGlzLnJlZ2lvbiArIHVybCxcbiAgICAgIH0pXG4gICAgICAuY2F0Y2goZXJyb3IgPT4ge1xuICAgICAgICBjb25zb2xlLmVycm9yKGVycm9yKTtcbiAgICAgICAgaWYgKGVycm9yLmVycikge1xuICAgICAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdChlcnJvci5lcnIpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdChlcnJvcik7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICB9XG5cbiAgYXN5bmMgX3Bvc3QodXJsOiBzdHJpbmcsIGRhdGE6IGFueSkge1xuICAgIC8vIGlmIHRoZSByZWdpb24gaXMgbm90IHNldCwgZ2V0IGl0IGZyb20gdGhlIGRhdGFzb3VyY2VcbiAgICBpZiAodHlwZW9mIHRoaXMucmVnaW9uID09PSAndW5kZWZpbmVkJykge1xuICAgICAgLy9jb25zb2xlLmxvZyhcImtlbnRpa0FQSS5fcG9zdDogdGhpcy5yZWdpb24gVU5ERUZJTkVELCBmZXRjaGluZ1wiKTtcbiAgICAgIGF3YWl0IHRoaXMuYmFja2VuZFNydi5nZXQoJy9hcGkvZGF0YXNvdXJjZXMnKS50aGVuKCAoYWxsRFM6IGFueSkgPT4ge1xuICAgICAgICB0aGlzLnNldFJlZ2lvbihnZXRSZWdpb24oYWxsRFMpKTtcbiAgICAgICAgLy9jb25zb2xlLmxvZyhcImtlbnRpa0FQSS5fcG9zdDogRkVUQ0hFRCByZWdpb24gXCIgKyB0aGlzLnJlZ2lvbik7XG4gICAgICB9KTtcbiAgICB9XG4gICAgcmV0dXJuIHRoaXMuYmFja2VuZFNydlxuICAgICAgLmRhdGFzb3VyY2VSZXF1ZXN0KHtcbiAgICAgICAgbWV0aG9kOiAnUE9TVCcsXG4gICAgICAgIHVybDogdGhpcy5iYXNlVXJsICsgXCIvXCIgKyB0aGlzLnJlZ2lvbiArIHVybCxcbiAgICAgICAgZGF0YTogZGF0YSxcbiAgICAgIH0pXG4gICAgICAudGhlbihyZXNwb25zZSA9PiB7XG4gICAgICAgIGlmIChyZXNwb25zZS5kYXRhKSB7XG4gICAgICAgICAgcmV0dXJuIHJlc3BvbnNlLmRhdGE7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgcmV0dXJuIFtdO1xuICAgICAgICB9XG4gICAgICB9KVxuICAgICAgLmNhdGNoKGVycm9yID0+IHtcbiAgICAgICAgY29uc29sZS5lcnJvcihlcnJvcik7XG4gICAgICAgIGlmIChlcnJvci5lcnIpIHtcbiAgICAgICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoZXJyb3IuZXJyKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoZXJyb3IpO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgfVxufVxuXG5hbmd1bGFyLm1vZHVsZSgnZ3JhZmFuYS5zZXJ2aWNlcycpLnNlcnZpY2UoJ2tlbnRpa0FQSVNydicsIEtlbnRpa0FQSSk7XG4iLCJpbXBvcnQgeyBLZW50aWtBUEkgfSBmcm9tICcuLi8uLi9kYXRhc291cmNlL2tlbnRpa0FQSSc7XG5pbXBvcnQgeyBzaG93QWxlcnQgfSBmcm9tIFwiLi4vLi4vZGF0YXNvdXJjZS9hbGVydEhlbHBlclwiO1xuXG5pbXBvcnQgeyBQYW5lbEN0cmwgfSBmcm9tICdncmFmYW5hL2FwcC9wbHVnaW5zL3Nkayc7XG5pbXBvcnQgeyBsb2FkUGx1Z2luQ3NzIH0gZnJvbSAnZ3JhZmFuYS9hcHAvcGx1Z2lucy9zZGsnO1xuaW1wb3J0IHsgZ2V0UmVnaW9uIH0gZnJvbSBcIi4uLy4uL2RhdGFzb3VyY2UvcmVnaW9uSGVscGVyXCI7XG5cbmltcG9ydCAqIGFzIF8gZnJvbSAnbG9kYXNoJztcblxubG9hZFBsdWdpbkNzcyh7XG4gIGRhcms6ICdwbHVnaW5zL2tlbnRpay1hcHAvY3NzL2tlbnRpay5kYXJrLmNzcycsXG4gIGxpZ2h0OiAncGx1Z2lucy9rZW50aWstYXBwL2Nzcy9rZW50aWsubGlnaHQuY3NzJyxcbn0pO1xuXG5jb25zdCBwYW5lbERlZmF1bHRzID0ge1xuICBmdWxsc2NyZWVuOiB0cnVlLFxufTtcblxuY2xhc3MgRGV2aWNlTGlzdEN0cmwgZXh0ZW5kcyBQYW5lbEN0cmwge1xuICBzdGF0aWMgdGVtcGxhdGVVcmw6IGFueTtcbiAgZGV2aWNlczogYW55W107XG4gIHBhZ2VSZWFkeTogYm9vbGVhbjtcbiAga2VudGlrOiBLZW50aWtBUEk7XG4gIHJlZ2lvbjogc3RyaW5nO1xuXG4gIC8qKiBAbmdJbmplY3QgKi9cbiAgY29uc3RydWN0b3IoJHNjb3BlLCAkaW5qZWN0b3IsIHB1YmxpYyAkbG9jYXRpb246IGFueSwgcHVibGljIGJhY2tlbmRTcnY6IGFueSkge1xuICAgIHN1cGVyKCRzY29wZSwgJGluamVjdG9yKTtcbiAgICBfLmRlZmF1bHRzKHRoaXMucGFuZWwsIHBhbmVsRGVmYXVsdHMpO1xuICAgIHRoaXMuZGV2aWNlcyA9IFtdO1xuICAgIHRoaXMucGFnZVJlYWR5ID0gZmFsc2U7XG4gICAgLy8gZ2V0IHJlZ2lvbiBmcm9tIGRhdGFzb3VyY2VcbiAgICAvL3RoaXMucmVnaW9uID0gXCJkZWZhdWx0XCI7XG4gICAgYmFja2VuZFNydi5nZXQoJy9hcGkvZGF0YXNvdXJjZXMnKS50aGVuKCAoYWxsRFM6IGFueSkgPT4ge1xuICAgICAgdGhpcy5yZWdpb24gPSBnZXRSZWdpb24oYWxsRFMpO1xuICAgICAgdGhpcy5rZW50aWsgPSBuZXcgS2VudGlrQVBJKHRoaXMuYmFja2VuZFNydik7XG4gICAgICB0aGlzLmtlbnRpay5zZXRSZWdpb24odGhpcy5yZWdpb24pO1xuICAgIH0pLnRoZW4gKGFzeW5jICgpID0+IHtcbiAgICAgIGF3YWl0IHRoaXMuZ2V0RGV2aWNlcygpO1xuICAgIH0pO1xuICB9XG5cbiAgYXN5bmMgZ2V0RGV2aWNlcygpIHtcbiAgICB0cnkge1xuICAgICAgdGhpcy5kZXZpY2VzID0gYXdhaXQgdGhpcy5rZW50aWsuZ2V0RGV2aWNlcygpO1xuICAgICAgdGhpcy5wYWdlUmVhZHkgPSB0cnVlO1xuICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgIHNob3dBbGVydChlKTtcbiAgICB9XG4gIH1cblxuICByZWZyZXNoKCkge1xuICAgIHRoaXMuZ2V0RGV2aWNlcygpO1xuICB9XG5cbiAgZ290b0Rhc2hib2FyZChkZXZpY2UpIHtcbiAgICB0aGlzLiRsb2NhdGlvbi5wYXRoKCcvZGFzaGJvYXJkL2RiL2tlbnRpay10b3AtdGFsa2VycycpLnNlYXJjaCh7ICd2YXItZGV2aWNlJzogZGV2aWNlLmRldmljZV9uYW1lIH0pO1xuICB9XG5cbiAgZ290b0RldmljZURldGFpbChkZXZpY2UpIHtcbiAgICB0aGlzLiRsb2NhdGlvbi51cmwoJy9wbHVnaW5zL2tlbnRpay1hcHAvcGFnZS9kZXZpY2UtZGV0YWlscz9kZXZpY2U9JyArIGRldmljZS5pZCk7XG4gIH1cbn1cblxuRGV2aWNlTGlzdEN0cmwudGVtcGxhdGVVcmwgPSAncHVibGljL3BsdWdpbnMva2VudGlrLWFwcC9jb21wb25lbnRzL2RldmljZV9saXN0Lmh0bWwnO1xuXG5leHBvcnQgeyBEZXZpY2VMaXN0Q3RybCBhcyBQYW5lbEN0cmwgfTtcbiJdLCJzb3VyY2VSb290IjoiIn0=